(function () {
  if (window.hasRun) {
    return;
  }
  window.hasRun = true;

  function addAsHindSiteTarget() {
    console.log('add as target');
  }
  function removeAsHindSiteTarget() {
    console.log('remove as target');
  }
  function doAsHindSiteTarget() {
    console.log('Open Menu');

    //browsers.windows.create({ url: ['./hindsite/autobuild/PopUp.min.html'] });

    var PopUp = "  <form><fieldset><legend id='lgnd-fore-site'>Fore&bull;Site</legend><div class='accordian-content'><button id='Edit' type='button' class='icon edit'>Edit</button><button id='Prev' type='button' class='icon preview-icon'>Preview</button><button id='Norm' type='button' class='icon normal'>Normal</button><button id='AdminB' type='button' class='icon admin-b'>Admin B</button><button id='Desktop' type='button' class='icon desktop-icon'>Desktop</button><button id='CE' type='button' class='icon ce'>Content Editor</button><button id='BigRed' type='button' class='icon add-ce-tab'>Add CE Tab to DT</button><button id='QuickPublish' type='button' class='icon publish'>Quick Publish</button><button id='PresentationDetails' type='button' class='icon details'>Presentation Details</button></div></fieldset><fieldset><legend id='lgnd-hind-site' data-setting='lgnd-hind-site'>Hind&bull;Site</legend><div class='accordian-content'><div class='col-6'><button id='SaveWindowState' type='button' class='icon take-snapshot'>Take Snapshot</button><!--<input type='checkbox' /> todo favorites only--><select id='selState' size='6'></select></div><div class='col-6-btn'><input type='text' id='inputNickname' value='' placeholder='Nick Name'><button id='UpdateNickname' type='button' class='icon set-nickname'>Set Nickname</button><button id='MarkFavorite' type='button' class='icon favorite'>Toggle Favorite</button><button id='RemoveOneFromLocalStorage' type='button' class='icon delete-snapshot'>Delete Snapshot</button><button id='RestoreWindowState' type='button' class='icon restore-snapshot'>Restore Snapshot</button><button id='Cancel' type='button' class='icon cancel'>Cancel</button></div></div></fieldset><fieldset><legend id='lgnd-in-site' data-setting='lgnd-in-site'>In&bull;Site</legend><div class='accordian-content'><div class='col-left'><div class='scroller'><textarea id='ta-feedback'></textarea></div></div><div class='col-right'><button id='DrawLocalStorage' type='button' class='icon draw-storage'>Draw Local Storage</button></div></div></fieldset><fieldset id='id-fieldset-debug'><legend id='lgnd-debug' data-setting='lgnd-debug'>Debug Info <span id='spanParentInfo'></span></legend><div class='accordian-content'><div class='col-full'><div class='scroller'><textarea id='ta-debug'></textarea></div></div></div></fieldset><fieldset><legend id='lgnd-settings' data-setting='lgnd-settings'>Settings/ Stats</legend><div class='accordian-content'><input type='checkbox' id='id-settings-show-debug-data'><label for='id-settings-show-debug-data'>Show Debug Data</label><label for='id-settings-auto-login'>Auto login</label><div id='stat-caller-id'></div><div id='stat-self-id'></div></div></fieldset></form><div class='menu-overlay' id='id-menu-overlay' style=''><div class='overlay-gray'></div><div class='overlay-solid'>            This menu is not controlled by the previously selected window.      <br>      Options:      <br><ul><li>Select the sitecore window that opened this menu and then click back here.</li><li>Rerun from the bookmarks button. That will hand over control to the current window</li><li>Close and rerun from the bookmarks button</li></ul>      This restriction is in place to avoid inadvertantly changing a hidden browser window.    </div></div>  ";
    var jsContent = "!function(e){var t={};function n(i){if(t[i])return t[i].exports;var a=t[i]={i:i,l:!1,exports:{}};return e[i].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){'undefined'!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:'Module'}),Object.defineProperty(e,'__esModule',{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&'object'==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,'default',{enumerable:!0,value:e}),2&t&&'string'!=typeof e)for(var a in e)n.d(i,a,function(t){return e[t]}.bind(null,a));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,'a',t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p='',n(n.s=0)}([function(e,t,n){'use strict';n.r(t);class i{constructor(e){e.FuncStart(i.name),this.debug=e,e.FuncEnd(i.name)}AssignMenuWindowChanged(e){window.addEventListener('click',t=>{e()}),window.addEventListener('resize',t=>{e()})}AssignOnClickEvent(e,t){var n=document.getElementById(e);n?n.addEventListener('click',e=>{t(e)}):this.debug.Error(this.AssignOnClickEvent.name,'No Id: '+e)}AssignOnChangeEvent(e,t){var n=document.getElementById(e);n?n.onchange=()=>{}:this.debug.Error(this.AssignOnClickEvent.name,'No Id: '+e)}AssignDblClickEvent(e,t){var n=document.getElementById(e);n?n.ondblclick=e=>{t(e)}:this.debug.Error(this.AssignOnClickEvent.name,'No Id: '+e)}}var a,o;!function(e){e[e.Unknown=0]='Unknown',e[e.Edit=1]='Edit',e[e.Preview=2]='Preview',e[e.Normal=3]='Normal'}(a||(a={}));class r{}r.const={Numbers:{ShortGuidLength:4,MinMenuHeight:600,MinMenuWidth:600},Iterations:{MaxSetHrefEffort:10,MaxIterationSwitchBoard:20},Timeouts:{PostLoginBtnClick:1e3,SetHrefEffortWait:1e3,WaitBeforeRemovingCompleteFlag:1500},IterHelper:{GrowthPerIteration:.5,MaxCount:{Default:10,OverridePublishing:15},Timeouts:{Max:1e4,Default:100}},ElemId:{HS:{SelStateSnapShot:'selState',TabId:'orig-win-id',TaDebug:'ta-debug',Btn:{AdminB:'AdminB',MarkFavoriteB:'MarkFavorite',Cancel:'Cancel',CE:'CE',Desktop:'Desktop',DrawStorage:'DrawLocalStorage',BigRed:'btnBigRed',ModeEdit:'Edit',ModeNorm:'Norm',ModePrev:'Prev',QuickPublish:'QuickPublish',RemoveFromStorage:'RemoveOneFromLocalStorage',RestoreWindowState:'RestoreWindowState',SaveWindowState:'SaveWindowState',UpdateNicknameB:'UpdateNickname'},Legend:{LgndSettings:'lgnd-settings',LgndInSite:'lgnd-in-site',LgndHindSite:'lgnd-hind-site',LgndDebug:'lgnd-debug',LgndForeSite:'lgnd-fore-site'}},HindSiteParentInfo:'spanParentInfo',InputNickname:'inputNickname',textAreaFeedback:'ta-feedback',sc:{scLoginUserName:'UserName',scLoginPassword:'Password',SitecoreRootNodeId:'Tree_Node_11111111111111111111111111111111',SitecoreRootGlyphId:'Tree_Glyph_11111111111111111111111111111111',scLoginBtn:{sc920:'LogInBtn',sc820:null}}},ClassNames:{ContentTreeNode:'scContentTreeNode',HS:{Collapsed:'in'},SC:{scContentTreeNodeActive:'scContentTreeNodeActive'}},UrlSuffix:{Desktop:'/sitecore/shell/default.aspx',Login:'/sitecore/login',LaunchPad:'/client/applications/launchpad',CE:'/sitecore/shell/Applications/Content Editor.aspx?sc_bw=1',None:'/'},Regex:{ContentEditor:/Content.*?Editor/gi},ScMode:{edit:{asEnum:a.Edit,asString:'edit'},normal:{asEnum:a.Normal,asString:'normal'},preview:{asEnum:a.Preview,asString:'preview'}},Notify:{Default:'Complete',PublishComplete:'Publishing Complete'},Selector:{HS:{iCBoxdSettingsShowDebugData:'[id=id-settings-show-debug-data]',IdFieldSetDebug:'[id=id-fieldset-debug]',menuOverlay:'[id=id-menu-overlay]',PrefAutoLogin:'[id=id-settings-auto-login]'},SC:{ContentTreeNodeGlyph:'.scContentTreeNodeGlyph',IdStartsWithTreeNode:'[id^=Tree_Node_]',IframeContent:'iframe[src*=content]',JqueryModalDialogsFrame:'[id=jqueryModalDialogsFrame]',ContentIframe0:'[id=scContentIframeId0]',NextButton:'[id=NextButton]',ContentIFrame1:'[id=scContentIframeId1]',Ok:'[id=OK]',Cancel:'[id=CancelButton]',MenuButtonPublish:'[id=B414550BADAF4542C9ADF44BED5FA6CB3E_menu_button]',MenuDropDownPublishItem:'[id=B414550BADAF4542C9ADF44BED5FA6CB3E_menu_98719A90225A4802A0625D3967E4DD47]',NavPublishStrip:'[id*=_Nav_PublishStrip]',StartMenuLeftOption:'.scStartMenuLeftOption',Publish:{TheItemHasBeenPublished:'[id=LastPage]:not([style*='display:none'])',SettingsHidden:'[id=Settings][style*='display: none']',PublishingHidden:'[id=Publishing][style*='display: none']'},LoginBtn:{sc920:null,sc820:'input.btn'},scStartButton:{sc920:'[id=StartButton]',sc820:'[id=startButton]'}}},Storage:{DefaultDebugKeepDialogOpen:!1,SettingsSuffix:'.Settings',ShowDebugData:!1,SnapShotSuffix:'.WindowSnapShot.',WindowRoot:'Xyyz'},MaxIter:100,MaxNullOrUndefinedIter:100,GuidEmpty:'00000000-0000-0000-0000-000000000000',prop:{AllTreeData:'AllTreeData'},Names:{SC:{TreeGlyphPrefix:'Tree_Glyph_',TreeNodePrefix:'Tree_Node_',TreeExpandedPng:{sc920:'treemenu_expanded.png',sc820:'todo'}},PopUp:'PopUp',PopUpStyles:'PopUpStyles',TreeMenuExpandedPng:'treemenu_expanded.png',TreeMenuCollapsedPng:'treemenu_collapsed.png',scDefaultAdminPassword:'b',scDefaultAdminUserName:'admin'}};class s{constructor(e){this.Xyyz=e}AtticMan(){return this.Xyyz.AtticMan}Const(){return this.Xyyz.Const}debug(){return this.hub.debug}DesktopMan(){return this.Xyyz.OneDesktopMan}GuidMan(){return this.Xyyz.GuidMan}locMan(){return this.Xyyz.LocationMan}OneCEMan(){return this.Xyyz.OneCEMan}OneWinMan(){return this.Xyyz.OneWindowMan}PageMan(){return this.Xyyz.PageMan}UiMan(){return this.Xyyz.UiMan}Utilites(){return this.Xyyz.Utilities}MiscMan(){return this.Xyyz.MiscMan}PromiseGen(){return this.Xyyz.PromiseGeneric}PromiseOneStep(){return this.Xyyz.PromiseOneStep}ScUiMan(){return this.Xyyz.SitecoreUiMan}}!function(e){e[e.Unknown=0]='Unknown',e[e.LoginPage=1]='LoginPage',e[e.Desktop=2]='Desktop',e[e.ContentEditor=3]='ContentEditor',e[e.Launchpad=4]='Launchpad',e[e.Edit=5]='Edit',e[e.Normal=6]='Normal',e[e.Preview=7]='Preview'}(o||(o={}));class d extends s{constructor(e){super(e),e.debug.FuncStart(d.name),e.debug.FuncEnd(d.name)}Init(){this.eventAwesome=new CustomEvent('awesome',{detail:'some detail'})}UpdateMenuCoords(e){var t=this.CurrentSettings();t.MenuPrefs=e,this.StoreSettings(t)}UpdateNickname(e){e.debug().FuncStart(e.UpdateNickname.name);var t=e.UiMan().GetIdOfSelectWindowSnapshot();if(t){var n=e.GetFromStorageById(t);if(n){var i=e.UiMan().GetValueInNickname();n.NickName=i,e.WriteToStorage(n)}}e.debug().FuncEnd(e.UpdateNickname)}MarkFavorite(){this.debug().FuncStart(this.MarkFavorite.name);var e=this.UiMan().GetIdOfSelectWindowSnapshot();if(e){var t=this.GetFromStorageById(e);t&&(t.IsFavorite=!t.IsFavorite,this.WriteToStorage(t))}this.debug().FuncEnd(this.MarkFavorite.name)}DrawDebugDataPretty(e){this.debug().FuncStart(this.DrawDebugDataPretty.name,'source not null: '+this.debug().IsNullOrUndefined(e));var t=this.__buildDebugDataPretty(e);t=t.concat(this.__drawSettings());for(var n=0;n<t.length;n++)this.Xyyz.FeedbackMan.WriteLine(t[n]);this.debug().FuncEnd(this.DrawDebugDataPretty.name)}__drawSettings(){var e=[],t=this.CurrentSettings();e.push('----- Settings - Accordian ------');for(var n=0;n<t.Accordian.length;n++)e.push(t.Accordian[n].ElemId+':'+t.Accordian[n].isCollapsed.toString());return e}__buildDebugDataPretty(e){this.debug().FuncStart(this.__buildDebugDataPretty.name,'data not null? '+this.debug().IsNullOrUndefined(e));var t=[];if(e){t.push('------ One Window Snap Shot Start -----'),t.push('Id: '+e.Id),t.push('TimeStamp: '+e.TimeStamp),t.push('CE Count: '+e.AllCEAr.length),t.push('Type: '+o[e.WindowType]),t.push('Nickname: '+e.NickName);for(var n=0;n<e.AllCEAr.length;n++){t.push('\t------ One CE Start -----');var i=e.AllCEAr[n];t.push('\tId: '+i.Id.asString);for(var a=this.Xyyz.OneCEMan.GetDebugDataOneCE(i),r=0;r<a.length;r++)t.push('\t\t'+a[r]);t.push('\t------ One CE End -----')}t.push('------ One Window Snap Shot End -----'),this.debug().FuncEnd(this.__buildDebugDataPretty.name)}else this.debug().Error(this.__buildDebugDataPretty.name,'missing data');return t}__drawStorageRaw(e){this.debug().FuncStart('DrawStorageRaw');for(var t=0;t<e.length;t++)this.debug().Log('key: \t'+e[t].key),this.debug().Log('data: \t'+e[t].data),this.debug().Log('------------');this.debug().FuncEnd('DrawStorageRaw')}__drawStoragePretty(e){this.debug().FuncStart(this.__drawStoragePretty.name),this.Xyyz.FeedbackMan.ClearTextArea();for(var t=0;t<e.length;t++){this.debug().Log('key: \t'+e[t].key);var n=JSON.parse(e[t].data);n&&(this.DrawDebugDataPretty(n),this.debug().Log('------------'))}this.debug().FuncEnd(this.__drawStoragePretty.name)}UpdateAccodianState(e,t){this.debug().FuncStart(this.UpdateAccodianState.name,e+' '+t);for(var n=this.CurrentSettings(),i=n.Accordian,a=null,o=0;o<i.length;o++){var r=i[o];if(r.ElemId===e){a=!0,r.isCollapsed=t;break}}if(!a){var s={ElemId:e,isCollapsed:t};i.push(s)}this.StoreSettings(n),this.debug().FuncStart(this.UpdateAccodianState.name)}StoreSettings(e){window.localStorage.setItem(this.Const().Storage.WindowRoot+this.Const().Storage.SettingsSuffix,JSON.stringify(e))}GetDefaultSettings(){return{DebugSettings:{KeepDialogOpen:this.Const().Storage.DefaultDebugKeepDialogOpen,ShowDebugData:this.Const().Storage.ShowDebugData},Accordian:[],MenuPrefs:{MenuHeight:null,MenuWidth:null,MenuX:null,MenuY:null}}}CurrentSettings(){var e,t=this.GetDefaultSettings(),n=window.localStorage.getItem(this.Const().Storage.WindowRoot+this.Const().Storage.SettingsSuffix);return n&&(e=JSON.parse(n)),e||(e=t),this.debug().NotNullCheck('toReturn',e),e.DebugSettings||(e.DebugSettings=t.DebugSettings),e.DebugSettings.KeepDialogOpen||(e.DebugSettings.KeepDialogOpen=t.DebugSettings.KeepDialogOpen),e.DebugSettings.ShowDebugData||(e.DebugSettings.ShowDebugData=t.DebugSettings.ShowDebugData),e.Accordian||(e.Accordian=[]),e.MenuPrefs||(e.MenuPrefs=t.MenuPrefs),e}DebugSettings(e){this.debug().FuncStart(this.DebugSettings.name),this.debug().LogVal('Settings',JSON.stringify(e)),this.debug().FuncEnd(this.DebugSettings.name)}__getAllLocalStorageAsIOneStorageData(){this.debug().FuncStart(this.__getAllLocalStorageAsIOneStorageData.name);for(var e=[],t=0;t<window.localStorage.length;t++){var n={data:'',key:''};n.key=window.localStorage.key(t),n.key.startsWith(this.Const().Storage.WindowRoot+this.Const().Storage.SnapShotSuffix)&&(n.data=window.localStorage.getItem(n.key),e.push(n))}return this.debug().FuncEnd(this.__getAllLocalStorageAsIOneStorageData.name),e}WriteToStorage(e){this.debug().FuncStart(this.WriteToStorage.name);var t=JSON.stringify(e);this.debug().Log('snapShotAsString: '+t),window.localStorage.setItem(this.Const().Storage.WindowRoot+this.Const().Storage.SnapShotSuffix+e.Id.asString,t),this.UiMan().RefreshUi(),this.debug().FuncEnd(this.WriteToStorage.name)}GetAllStorageAsIDataOneWindow(){this.debug().FuncStart(this.GetAllStorageAsIDataOneWindow.name);var e=[],t=this.__getAllLocalStorageAsIOneStorageData();if(t)for(var n=0;n<t.length;n++){var i=t[n],a=JSON.parse(i.data);a&&(a.TimeStamp=new Date(a.TimeStamp),a.Id=this.Xyyz.GuidMan.ParseGuid(a.Id.asString),a.RawData=i,a.WindowType||(a.WindowType=o.Unknown,a.WindowFriendly=o[a.WindowType]),a.NickName||(a.NickName=''),e.push(a))}return e.sort((e,t)=>+t.TimeStamp-+e.TimeStamp),this.debug().FuncEnd(this.GetAllStorageAsIDataOneWindow.name),e}RemoveOneFromStorage(){this.debug().FuncStart(this.RemoveOneFromStorage.name);var e=this.UiMan().GetIdOfSelectWindowSnapshot();if(e){var t=this.GetFromStorageById(e);if(t)!0===confirm('Remove ?: '+this.Xyyz.Utilities.TimeNicknameFavStr(t))&&window.localStorage.removeItem(t.RawData.key)}this.UiMan().RefreshUi(),this.debug().FuncEnd(this.RemoveOneFromStorage.name)}DrawStorage(){this.debug().FuncStart('DrawStorage');try{var e=this.__getAllLocalStorageAsIOneStorageData();e&&(this.__drawStorageRaw(e),this.__drawStoragePretty(e))}catch(e){this.hub.debug.Error(this.DrawStorage.name,e.message)}this.debug().FuncEnd('DrawStorage')}GetRawFromStorageById(e){this.debug().FuncStart(this.GetRawFromStorageById.name,e.asString);var t=this.__getAllLocalStorageAsIOneStorageData();if(t)for(var n=0;n<t.length;n++)t[n];return this.debug().FuncEnd(this.GetRawFromStorageById.name),null}GetFromStorageById(e){this.debug().FuncStart(this.GetFromStorageById.name,e.asString);var t=this.GetAllStorageAsIDataOneWindow(),n=null;if(t)for(var i=0;i<t.length;i++){var a=t[i];if(a.Id.asString===e.asString){n=a;break}}return n?this.debug().Log('found match',this.Utilites().TimeNicknameFavStr(n)):this.debug().Error(this.GetFromStorageById.name,'Match notfound'),this.debug().FuncEnd(this.GetFromStorageById.name),n}}var u=function(e,t,n,i){return new(n||(n=Promise))((function(a,o){function r(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}d((i=i.apply(e,t||[])).next())}))};class h extends s{constructor(e){super(e)}Init(){this.__wireMenuButtons()}__wireMenuButtons(){this.debug().FuncStart(this.__wireMenuButtons.name),this.ScUiMan().AssignDblClickEvent(this.Const().ElemId.HS.SelStateSnapShot,e=>{this.__hndlrRestoreClick(e)}),this.ScUiMan().AssignDblClickEvent(this.Const().ElemId.HS.TaDebug,()=>{this.__cleardebugTextWithConfirm()}),this.ScUiMan().AssignOnChangeEvent(this.Const().ElemId.HS.SelStateSnapShot,e=>{this.Xyyz.UiMan.SelectChanged()}),this.ScUiMan().AssignMenuWindowChanged(e=>{this.__hndlrMenuWindowChanged()}),this.ScUiMan().AssignOnClickEvent(this.Const().ElemId.HS.Btn.AdminB,()=>{this.__handlrB()}),this.ScUiMan().AssignOnClickEvent(this.Const().ElemId.HS.Btn.Cancel,e=>{this.__hndlrCancelOperation(e)}),this.ScUiMan().AssignOnClickEvent(this.Const().ElemId.HS.Btn.CE,()=>{this.__hndlrOpenCE()}),this.ScUiMan().AssignOnClickEvent(this.Const().ElemId.HS.Btn.Desktop,e=>{this.__hndlrDesktop(e)}),this.ScUiMan().AssignOnClickEvent(this.Const().ElemId.HS.Btn.DrawStorage,this.AtticMan().DrawStorage),this.ScUiMan().AssignOnClickEvent(this.Const().ElemId.HS.Btn.ModeEdit,e=>this.__hndlrSetScMode(this.Const().ScMode.edit,e)),this.ScUiMan().AssignOnClickEvent(this.Const().ElemId.HS.Btn.ModeNorm,e=>this.__hndlrSetScMode(this.Const().ScMode.normal,e)),this.ScUiMan().AssignOnClickEvent(this.Const().ElemId.HS.Btn.ModePrev,e=>this.__hndlrSetScMode(this.Const().ScMode.preview,e)),this.ScUiMan().AssignOnClickEvent(this.Const().ElemId.HS.Btn.QuickPublish,e=>{this.__hndlrQuickPublish(e)}),this.ScUiMan().AssignOnClickEvent(this.Const().ElemId.HS.Btn.RemoveFromStorage,this.AtticMan().RemoveOneFromStorage),this.ScUiMan().AssignOnClickEvent(this.Const().ElemId.HS.Btn.RestoreWindowState,e=>{this.__hndlrRestoreClick(e)}),this.ScUiMan().AssignOnClickEvent(this.Const().ElemId.HS.Btn.SaveWindowState,e=>{this.__hndlrTakeSnapShot(e)}),this.ScUiMan().AssignOnClickEvent(this.Const().ElemId.HS.Btn.UpdateNicknameB,()=>this.__updateNickName()),this.ScUiMan().AssignOnClickEvent(this.Const().ElemId.HS.Btn.BigRed,()=>this.__hndlrAddCETab),this.ScUiMan().AssignOnClickEvent(this.Const().ElemId.HS.Legend.LgndDebug,e=>{this.__toggleAccordian(e)}),this.ScUiMan().AssignOnClickEvent(this.Const().ElemId.HS.Legend.LgndForeSite,e=>{this.__toggleAccordian(e)}),this.ScUiMan().AssignOnClickEvent(this.Const().ElemId.HS.Legend.LgndHindSite,e=>{this.__toggleAccordian(e)}),this.ScUiMan().AssignOnClickEvent(this.Const().ElemId.HS.Legend.LgndInSite,e=>{this.__toggleAccordian(e)}),this.ScUiMan().AssignOnClickEvent(this.Const().ElemId.HS.Legend.LgndSettings,e=>{this.__toggleAccordian(e)}),this.debug().FuncEnd(this.__wireMenuButtons.name)}__hndlrSetScMode(e,t){return u(this,void 0,void 0,(function*(){this.__initNewOperation(),yield this.locMan().SetScMode(e,t.ctrlKey).then(()=>this.UiMan().NotifyComplete())}))}__updateNickName(){var e=this.Xyyz.AtticMan;this.Xyyz.AtticMan.UpdateNickname(e)}__cleardebugTextWithConfirm(){this.hub.debug.HndlrClearDebugText(this.debug(),!0)}__cleardebugText(){this.hub.debug.HndlrClearDebugText(this.debug())}__toggleAccordian(e){this.debug().FuncStart(this.__toggleAccordian.name);var t=e.target||e.srcElement,n=this.UiMan().GetAccordianContentElem(t);if(n){var i=!n.classList.contains(this.Const().ClassNames.HS.Collapsed);this.UiMan().SetAccordianClass(n,i),this.AtticMan().UpdateAccodianState(t.getAttribute('id'),i)}else this.debug().Error(this.__toggleAccordian.name,'did not find sib');this.debug().FuncEnd(this.__toggleAccordian.name)}__handlrB(){this.locMan().AdminB(this.PageMan().TopLevelWindow().DataDocSelf,null)}__hndlrMenuWindowChanged(){var e={MenuX:window.screenX||window.screenLeft||0,MenuY:window.screenY||window.screenTop||0,MenuHeight:window.outerHeight,MenuWidth:window.outerWidth};this.AtticMan().UpdateMenuCoords(e),this.__verifyMatchingTab()}__verifyMatchingTab(){}__hndlrDesktop(e){this.__initNewOperation(),this.locMan().ChangeLocationSwitchBoard(o.Desktop,this.PageMan().TopLevelWindow())}__hndlrCancelOperation(e){this.UiMan().SetCancelFlag()}__hndlrQuickPublish(e){return u(this,void 0,void 0,(function*(){this.__initNewOperation();var e=this.PageMan().TopLevelWindow();yield this.OneWinMan().PublishActiveCE(e).then(()=>{this.UiMan().NotifyComplete(null,this.Const().Notify.PublishComplete)})}))}__hndlrTakeSnapShot(e){this.__initNewOperation(),this.Xyyz.OneWindowMan.SaveWindowState(this.PageMan().TopLevelWindow())}__hndlrAddCETab(){return u(this,void 0,void 0,(function*(){this.__initNewOperation(),yield this.PromiseGen().RaceWaitAndClick(this.Const().Selector.SC.scStartButton,this.PageMan().TopLevelWindow().DataDocSelf).then(()=>{this.PromiseGen().WaitForThenClick(this.Const().Selector.SC.StartMenuLeftOption,this.PageMan().TopLevelWindow().DataDocSelf)})}))}__hndlrOpenCE(){this.__initNewOperation(),this.locMan().ChangeLocationSwitchBoard(o.ContentEditor,this.PageMan().TopLevelWindow())}__initNewOperation(){this.__cleardebugText(),this.UiMan().ClearCancelFlag()}__hndlrRestoreClick(e){return u(this,void 0,void 0,(function*(){this.debug().FuncStart(this.__hndlrRestoreClick.name),this.__initNewOperation();try{var t=this.UiMan().GetIdOfSelectWindowSnapshot();this.debug().MarkerA();var n=this.AtticMan().GetFromStorageById(t);this.debug().MarkerB();var i=yield this.PageMan().GetTargetWindowAsync(!!e.ctrlKey,n.WindowType);i?yield this.Xyyz.OneWindowMan.RestoreWindowStateToTarget(i,n).then(()=>{this.UiMan().NotifyComplete(i)}).then(()=>{}):this.debug().Error(this.__hndlrRestoreClick.name,'no target window')}catch(e){this.debug().Error(this.__hndlrRestoreClick.name,e)}this.debug().FuncEnd(this.__hndlrRestoreClick.name)}))}}class l extends s{constructor(e){super(e)}__getTextArea(){return document.getElementById(this.Const().ElemId.textAreaFeedback)}ClearTextArea(){var e=this.__getTextArea();e?e.value='':this.debug().Error(l.name,'No text area found')}WriteLine(e){var t=this.__getTextArea();t&&(t.value+=e+'\n')}}class c extends s{constructor(e){super(e)}EmptyGuid(){return this.ParseGuid(this.Const().GuidEmpty)}NewGuid(){var e='xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return('x'==e?t:3&t|8).toString(16)}));return this.ParseGuid(e)}ShortGuid(e){var t='{error}';return e&&e.asString.length>this.Const().Numbers.ShortGuidLength&&(t=e.asString.substr(0,this.Const().Numbers.ShortGuidLength)),t}ParseGuid(e){let t={asString:e,asShort:''};return t.asShort=this.ShortGuid(t),t}}var g=function(e,t,n,i){return new(n||(n=Promise))((function(a,o){function r(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}d((i=i.apply(e,t||[])).next())}))};class m extends s{constructor(e){super(e),e.debug.FuncStart(m.name),e.debug.FuncEnd(m.name)}SetHref(e,t,n,i=this.Const().Iterations.MaxSetHrefEffort){this.debug().FuncStart(this.SetHref.name,e+' : '+i+' : has callback? '+(null!==t)),i-=1;var a=n.Window.location.href=e,o='complete'===n.DataDocSelf.Document.readyState;if(i>0)if(a&&o)this.debug().Log(this.SetHref.name,'triggering callback'),t();else{a||n.Window.location.href;var r=this;setTimeout((function(){this.debug().Log('setting timeout'),r.SetHref(e,t,n,i)}),r.Const().Timeouts.SetHrefEffortWait)}else this.debug().Log('changing href unsuccessful. Dying');this.debug().FuncEnd(this.SetHref.name)}ChangeLocationSwitchBoard(e,t,n=this.Const().Iterations.MaxIterationSwitchBoard){if(this.debug().FuncStart(this.ChangeLocationSwitchBoard.name,'desired = '+o[e]+' iteration: '+n+':'+this.Const().Iterations.MaxIterationSwitchBoard),n>0){n-=1;var i=this.PageMan().GetCurrentPageType();if(i===o.LoginPage){var a=this;this.AdminB(t.DataDocSelf,()=>{this.debug().Log('callback triggered'),a.ChangeLocationSwitchBoard(e,t,n)});a=this}else if(i===o.Launchpad||i===o.ContentEditor||i===o.Desktop){a=this;var r=function(){a.debug().Log('Callback triggered'),t=a.PageMan().SetWindowDataToCurrent(t.Window,t.DataDocSelf.Nickname),a.ChangeLocationSwitchBoard(e,t,n)};e===o.Desktop&&i!==o.Desktop?this.SetHref(this.Const().UrlSuffix.Desktop,r,t):e===o.ContentEditor&&i!==o.ContentEditor?this.SetHref(this.Const().UrlSuffix.CE,r,t):i===o.Desktop&&e===o.Desktop&&this.debug().Log('On Desktop')}}this.debug().FuncEnd(this.ChangeLocationSwitchBoard.name)}SetScMode(e,t){return new Promise(()=>g(this,void 0,void 0,(function*(){var n,i;this.debug().FuncStart(this.SetScMode.name,e.asString);var a=this.PageMan().GetCurrentPageType();if(a===o.ContentEditor||a===o.Desktop){for(var r=this.PageMan().TopLevelWindow().DataDocSelf,s=this.Xyyz.OneTreeMan.GetOneLiveTreeData(r),d=0;d<s.length;d++){var u=s[d];if(u.IsActive){n=u.NodeId;break}}yield alert(n.asString),n&&(i=yield this.PageMan().GetTargetWindowAsync(t,o.Edit))}else a!=o.Edit&&a!=o.Normal&&a!=o.Preview||i&&(window.opener.location.href=window.opener.location.href.replace('=normal',e.asString).replace('=preview',e.asString).replace('=edit',e.asString));this.debug().FuncEnd(this.SetScMode.name)})))}GetLoginButton(e){this.debug().FuncStart(this.GetLoginButton.name);var t=e.Document.getElementById(this.Const().ElemId.sc.scLoginBtn.sc920);return t||(t=e.Document.querySelector(this.Const().Selector.SC.LoginBtn.sc820)),this.debug().Log('toReturn: '+t),this.debug().FuncEnd(this.GetLoginButton.name),t}AdminB(e,t){this.debug().FuncStart(this.AdminB.name,'targetDoc: '+e.XyyzId.asShort),this.debug().Log('callback passed: '+(null!==t));var n=e.Document.getElementById(this.Const().ElemId.sc.scLoginUserName),i=e.Document.getElementById(this.Const().ElemId.sc.scLoginPassword);this.debug().Log('userNameElem: '+n),this.debug().Log('passwordElem: '+i),n.setAttribute('value',this.Const().Names.scDefaultAdminUserName),i.setAttribute('value',this.Const().Names.scDefaultAdminPassword);var a=this.GetLoginButton(e);a?(this.debug().Log('clicking'),a.click(),t?(this.debug().Log('Triggering callback'),setTimeout(t,this.Const().Timeouts.PostLoginBtnClick)):this.debug().Log('no callback passed')):this.debug().Error(this.AdminB.name,'No loginButton'),this.debug().FuncEnd(this.AdminB.name)}QkID(){return this.Const().ElemId}}class S extends s{constructor(e){super(e)}NotNullOrUndefined(e,t='',n=null){var i=!1;if(n||(n=this.Const().MaxNullOrUndefinedIter),(n-=1)>0)if(''===t&&(t=this.NotNullOrUndefined.name+' : no labelprovided'),'undefined'===e)this.debug().Error(t,'Is undefined');else if(e){if(this.debug().LogVal(t,'Passed'),i=!0,Array.isArray(e))for(var a=0;a<e.length;a++)i=i&&this.NotNullOrUndefined(e[a],a+1+':'+e.length+' '+t,n)}else this.debug().Error(t,'Is Null');else this.debug().Error(this.NotNullOrUndefined.name,'max iteration hit');return i}}class f extends s{constructor(e,t,n=null){super(e),n||(n=this.Const().IterHelper.MaxCount.Default),this.__maxIterations=n,this.__currentIteration=n,this.__timeout=e.Const.IterHelper.Timeouts.Default,this.__nickName=t,this.IsExhausted=!1}DecrementAndKeepGoing(){var e=!1;return!this.UiMan().OperationCancelled&&this.__currentIteration>0?(this.__currentIteration-=1,this.__timeout+=this.__timeout*this.Const().IterHelper.GrowthPerIteration,this.__timeout>this.Const().IterHelper.Timeouts.Max&&(this.__timeout=this.Const().IterHelper.Timeouts.Max),this.debug().Log('DecrementAndKeepGoing: '+this.__nickName+' '+this.__currentIteration+':'+this.__maxIterations+' | timeout: '+this.__timeout),e=!0):(this.IsExhausted=!0,this.NotifyExhausted(),e=!1),e}NotifyExhausted(){this.debug().Log('Iteration: '+this.__nickName+' counter exhausted '+this.__currentIteration+':'+this.__maxIterations)}WaitAndThen(e){this.debug().FuncStart(this.WaitAndThen.name,this.__nickName+' '+e.name);setTimeout(e(),this.__timeout),this.debug().FuncEnd(this.WaitAndThen.name,this.__nickName)}Wait(){if(!this.UiMan().OperationCancelled)return new Promise(e=>{setTimeout(e,this.__timeout)})}}var b=function(e,t,n,i){return new(n||(n=Promise))((function(a,o){function r(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}d((i=i.apply(e,t||[])).next())}))};class D extends s{constructor(e){super(e)}WaitForNode(e,t,n,i,a){this.debug().FuncStart(this.WaitForNode.name,'looking for guid: iter: '+n+' '+e.asString+' on '+this.GuidMan().ShortGuid(t.XyyzId)),n--;var o=t.Document.getElementById(e.asString);if(o)this.debug().Log('foundOnPage. Triggering callback on complete'),this.__expandNode(o),a(o);else if(n>0){this.debug().Log('not found on page...setting timeout: '+i);var r=this;setTimeout((function(){n-=1,r.WaitForNode(e,t,n,i,a)}),i)}else this.debug().Log('Not Found. Triggering callback on complete'),a(null);this.debug().FuncEnd(this.WaitForNode.name)}__activateNode(e){this.debug().FuncStart(this.__activateNode.name),this.debug().Log('clicking it'),e.click(),this.debug().FuncEnd(this.__activateNode.name)}__expandNode(e){this.debug().FuncStart(this.__expandNode.name);var t=e.getAttribute('src');this.debug().Log('currentSrc'+t),t.indexOf(this.Const().Names.TreeMenuExpandedPng)<0&&(this.debug().Log('clicking it'),e.click()),this.debug().FuncEnd(this.__expandNode.name)}__collapseNode(e){var t=e.getAttribute('src');this.debug().Log('currentSrc'+t),t.indexOf(this.Const().Names.TreeMenuExpandedPng)>-1&&(this.debug().Log('clicking it'),e.click())}__collapseRootNode(e){var t=e.Document.getElementById(this.Const().ElemId.sc.SitecoreRootGlyphId);t?this.__collapseNode(t):this.debug().Error(this.__collapseRootNode.name,'Root glyph not found '+this.Const().ElemId.sc.SitecoreRootGlyphId)}WaitForAndRestoreOneNode(e,t){return b(this,void 0,void 0,(function*(){this.debug().FuncStart(this.WaitForAndRestoreOneNode.name,t.XyyzId.asShort);var n=this.Const().Names.SC.TreeGlyphPrefix+e.NodeId.asString;this.debug().Log('looking for: '+n+' '+e.NodeFriendly+' in '+t.XyyzId.asShort),this.debug().Log('document not null '+(null!=t.Document));for(var i=new f(this.Xyyz,this.WaitForAndRestoreOneNode.name),a=null;!a&&i.DecrementAndKeepGoing();)if(this.debug().Log('looking for: *'+n+'* '+e.NodeFriendly+' in *'+t.XyyzId.asShort+'*'),a=t.Document.getElementById(n)){if(e.IsExpanded&&this.__expandNode(a),e.IsActive){var o=this.Const().Names.SC.TreeNodePrefix+e.NodeId.asString,r=t.Document.getElementById(o);r&&this.__activateNode(r)}}else this.debug().Log('not Found...waiting: '),yield i.Wait();this.debug().FuncEnd(this.WaitForAndRestoreOneNode.name,t.XyyzId.asShort)}))}WaitForAndRestoreManyAllNodes(e,t,n=null){return b(this,void 0,void 0,(function*(){for(this.debug().FuncStart(this.WaitForAndRestoreManyAllNodes.name,t.XyyzId.asShort),n||(n=new f(this.Xyyz,this.WaitForAndRestoreManyAllNodes.name));e.AllTreeNodeAr.length>0&&n.DecrementAndKeepGoing();){var i=e.AllTreeNodeAr.shift();yield this.WaitForAndRestoreOneNode(i,t)}this.debug().FuncEnd(this.WaitForAndRestoreManyAllNodes.name)}))}RestoreCEStateAsync(e,t){return b(this,void 0,void 0,(function*(){this.debug().FuncStart(this.RestoreCEStateAsync.name,t.XyyzId.asShort);return this.debug().Log('Node Count in storage data: '+e.AllTreeNodeAr.length),yield this.WaitForAndRestoreManyAllNodes(e,t),this.debug().FuncEnd(this.RestoreCEStateAsync.name),!1}))}SaveStateOneContentEditor(e,t){this.debug().FuncStart('SaveOneContentEditor'),this.debug().Log('SaveOneContentEditor'),this.debug().Log('docElem is null: '+(null===t));var n=this.Xyyz.OneCEMan.MakeNewData(e);n.AllTreeNodeAr=this.Xyyz.OneTreeMan.GetOneLiveTreeData(t),this.Xyyz.OneWindowMan.PutCEDataToCurrentSnapShot(n),this.debug().FuncEnd('SaveOneContentEditor')}MakeNewData(e){this.debug().FuncStart('MakeNewData: '+e);var t={Id:e,AllTreeNodeAr:[]};return this.debug().FuncEnd('MakeNewData: '+e),t}DebugDataOneNode(e){this.debug().FuncStart(this.DebugDataOneNode.name);var t=(e.IsActive?'* ':'  ')+(e.IsExpanded?'+ ':'  ')+e.NodeId.asString+' '+e.NodeFriendly;return this.debug().FuncEnd(this.DebugDataOneNode.name),t}GetDebugDataOneCE(e){this.debug().FuncStart('GetDebugDataOneCE');var t=[];t.push('------ All Tree Nodes -----');for(var n=0;n<e.AllTreeNodeAr.length;n++){this.debug().Log('idx: '+n);var i=this.DebugDataOneNode(e.AllTreeNodeAr[n]);this.debug().Log('oneVal : '+i),t.push(i)}return this.debug().FuncEnd(this.GetDebugDataOneCE.name),t}}var C=function(e,t,n,i){return new(n||(n=Promise))((function(a,o){function r(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}d((i=i.apply(e,t||[])).next())}))};class v extends s{constructor(e){e.debug.FuncStart(v.name),super(e),e.debug.FuncEnd(v.name)}__waitForAndClickRedStartButtonPromise(e){return new Promise((t,n)=>C(this,void 0,void 0,(function*(){this.debug().FuncStart(this.__waitForAndClickRedStartButtonPromise.name),this.MiscMan().NotNullOrUndefined([e,e.targetDoc],this.__waitForAndClickRedStartButtonPromise.name)?yield this.PromiseGen().RaceWaitAndClick(this.Const().Selector.SC.scStartButton,e.targetDoc).then(()=>t(e)).catch(e=>{this.debug().Error(this.__waitForAndClickRedStartButtonPromise.name,e),n()}):n(),this.debug().FuncEnd(this.__waitForAndClickRedStartButtonPromise.name)})))}__waitForIframeReady(e){return new Promise((t,n)=>C(this,void 0,void 0,(function*(){this.debug().FuncStart(this.__waitForIframeReady.name,'promiseBucket not null: '+(null!==e)),this.debug().PromiseBucketDebug(e,this.__waitForIframeReady.name),(yield this.PromiseGen().WaitForReadyIframe(e.NewIframe))?(this.debug().Log('resolved! : '),e.NewIframe.ContentDoc.Document=e.NewIframe.IframeElem.contentDocument,this.debug().DebugDataOneIframe(e.NewIframe),t(e)):(this.debug().Log('rejected ! : '),n(this.__waitForIframeReady.name)),this.debug().FuncEnd(this.__waitForIframeReady.name)})))}__waitForIframeCountDiffPromise(e){return new Promise((t,n)=>C(this,void 0,void 0,(function*(){this.debug().FuncStart(this.__waitForIframeCountDiffPromise.name),this.debug().MarkerA();var i=yield this.DesktopMan().WaitForIframeCountDiffWorker(e.IFramesbefore,e.targetWindow);this.debug().MarkerB(),i?(this.debug().MarkerC(),e.NewIframe=i,this.debug().DebugDataOneIframe(e.NewIframe),t(e)):n(this.__waitForIframeCountDiffPromise.name),this.debug().FuncEnd(this.__waitForIframeCountDiffPromise.name)})))}__waitForAndThenClickCEFromMenuPromise(e){return new Promise((t,n)=>C(this,void 0,void 0,(function*(){yield this.PromiseGen().WaitForThenClick(this.Const().Selector.SC.StartMenuLeftOption,e.targetWindow.DataDocSelf).then(()=>{t(e)}).catch(e=>{n(this.__waitForAndThenClickCEFromMenuPromise.name)})})))}__restoreDataToOneIframe(e){return new Promise((t,n)=>C(this,void 0,void 0,(function*(){this.debug().FuncStart(this.__restoreDataToOneIframe.name),this.debug().DebugDataOneIframe(e.NewIframe),(yield this.DesktopMan().RestoreDataToOneIframeWorker(e.oneCEdata,e.NewIframe))?t(e):n(this.__restoreDataToOneIframe.name),this.debug().FuncEnd(this.__restoreDataToOneIframe.name)})))}RunOneChain(e,t){return C(this,void 0,void 0,(function*(){if(this.debug().FuncStart(this.RunOneChain.name),this.MiscMan().NotNullOrUndefined([e,t],this.RunOneChain.name)){var n=this.DesktopMan().GetAllLiveIframeData(e),i={targetWindow:e,targetDoc:e.DataDocSelf,IFramesbefore:n,oneCEdata:t,NewIframe:null,LastChainLinkSuccessful:!1};yield this.__waitForAndClickRedStartButtonPromise(i).then(e=>this.__waitForAndThenClickCEFromMenuPromise(e)).then(e=>this.__waitForIframeCountDiffPromise(e)).then(e=>this.__waitForIframeReady(e)).then(e=>this.__restoreDataToOneIframe(e)).catch(e=>{this.debug().Error(this.RunOneChain.name,e)}),this.debug().FuncEnd(this.RunOneChain.name)}}))}}var w=function(e,t,n,i){return new(n||(n=Promise))((function(a,o){function r(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}d((i=i.apply(e,t||[])).next())}))};class _ extends s{constructor(e){e.debug.FuncStart(_.name),super(e),e.debug.FuncEnd(_.name)}RestoreDesktopStateAsync(e,t){return w(this,void 0,void 0,(function*(){if(this.debug().FuncStart(this.RestoreDesktopStateAsync.name),this.MiscMan().NotNullOrUndefined([e,t,t.AllCEAr],this.RestoreDesktopStateAsync.name))for(var n=0;n<t.AllCEAr.length;n++){this.debug().Log('data idx: '+n+':'+t.AllCEAr.length);var i=new v(this.Xyyz);yield i.RunOneChain(e,t.AllCEAr[n])}this.debug().FuncEnd(this.RestoreDesktopStateAsync.name)}))}RestoreDataToOneIframeWorker(e,t){return w(this,void 0,void 0,(function*(){this.debug().FuncStart(this.RestoreDataToOneIframeWorker.name,'data not null: '+(null!=e)+' newFrame not null: '+(null!==t));var n=!1;return this.debug().DebugDataOneIframe(t),e&&t?(yield this.Xyyz.OneCEMan.RestoreCEStateAsync(e,t.ContentDoc),n=!0):(this.debug().Error(this.RestoreDataToOneIframeWorker.name,'bad data'),n=!1),this.debug().FuncEnd(this.RestoreDataToOneIframeWorker.name,n.toString()),n}))}WaitForIframeCountDiffWorker(e,t){return w(this,void 0,void 0,(function*(){this.debug().FuncStart(this.WaitForIframeCountDiffWorker.name);for(var n=null,i=new f(this.Xyyz,this.WaitForIframeCountDiffWorker.name);!n&&i.DecrementAndKeepGoing();){let r=e.length;var a=this.GetAllLiveIframeData(t),o=a.length;if(this.debug().Log('iFrame count before: '+e.length),this.debug().Log('iFrame count after: '+a.length),o>r){n=a.filter(t=>!e.includes(t))[0]}else{yield i.Wait()}}return this.debug().FuncEnd(this.WaitForIframeCountDiffWorker.name),n}))}GetAllLiveIframeData(e){this.debug().FuncStart(this.GetAllLiveIframeData.name);var t=[],n=e.DataDocSelf.Document.querySelectorAll(this.Const().Selector.SC.IframeContent);if(n){this.debug().Log('iframeAr: '+n.length);for(var i=0;i<n.length;i++){this.debug().Log('pushing: '+i);var a=n[i],o=this.Utilites().DateOneIframeFactory(a,e.DataDocSelf,'desktop Iframe_'+i);o.ContentDoc.HasParentDesktop=!0,o.ContentDoc.IsCEDoc=!0,t.push(o)}}return this.debug().FuncEnd(this.GetAllLiveIframeData.name,'count:  '+t.length),t}SaveStateOneDesktop(e){this.debug().FuncStart(this.SaveStateOneDesktop.name),this.debug().Log('SaveOneDesktop');var t=this.GetAllLiveIframeData(e);if(t&&t.length>0)for(var n=0;n<t.length;n++){this.debug().Log('iframeIdx: '+n);var i=t[n];this.Xyyz.OneCEMan.SaveStateOneContentEditor(i.Id,i.ContentDoc)}this.debug().FuncEnd(this.SaveStateOneDesktop.name)}}class p extends s{constructor(e){super(e),e.debug.FuncStart(p.name),e.debug.FuncEnd(p.name)}GetFriendlyNameFromNode(e){this.debug().FuncStart(this.GetFriendlyNameFromNode.name);var t='unknown',n=e.parentNode.querySelector(this.Const().Selector.SC.IdStartsWithTreeNode);return n?t=n.innerText:this.debug().Log('No treeNode'),this.debug().FuncEnd(this.GetFriendlyNameFromNode.name,t),t}__isActive(e){var t=!1,n=e.querySelector(this.Const().Selector.SC.IdStartsWithTreeNode);n&&(n.className.indexOf(this.Const().ClassNames.SC.scContentTreeNodeActive)>-1&&(t=!0,this.debug().Log('** isActive '+e.innerText)));return t}__isExpanded(e){var t=!1;if(e)return e.getAttribute('src').indexOf(this.Const().Names.SC.TreeExpandedPng.sc920)>-1&&(t=!0),t}__isContentTreeNode(e){var t=!1;return e.className===this.Const().ClassNames.ContentTreeNode&&(t=!0),t}WalkNodeRecursive(e,t){var n=[];if(t-=1,e){var i=e.querySelector(this.Const().Selector.SC.ContentTreeNodeGlyph);if(this.__isContentTreeNode(e)){var a={IsExpanded:this.__isExpanded(i),IsActive:this.__isActive(e),NodeFriendly:'',NodeId:null};if(a.IsExpanded||a.IsActive){this.debug().LogVal('isExpanded',a.IsExpanded.toString()),this.debug().LogVal('isActive',a.IsActive.toString()),a.NodeFriendly=this.GetFriendlyNameFromNode(i),this.debug().LogVal('friendlyName',a.NodeFriendly);var o=i.id.replace(this.Const().Names.SC.TreeGlyphPrefix,'');a.NodeId=this.Xyyz.GuidMan.ParseGuid(o),n.push(a)}}var r=e.children;if(r&&r.length>0&&t>0)for(var s=0;s<r.length;s++){var d=r[s];n=n.concat(this.WalkNodeRecursive(d,t))}}return n}GetOneLiveTreeData(e){this.debug().FuncStart(this.GetOneLiveTreeData.name),this.debug().Log('targetDoc isnull: '+(null===e));var t=[];if(e){var n=e.Document.getElementById(this.Const().ElemId.sc.SitecoreRootNodeId);if(n){this.debug().Log('rootNode: '+n.innerHTML);var i=n.parentElement;t=this.WalkNodeRecursive(i,this.Const().MaxIter),this.debug().Log('foundNodes count: '+t.length)}else this.debug().Error(this.GetOneLiveTreeData.name,'no root node')}else this.debug().Error(this.GetOneLiveTreeData.name,'no targetDoc');return this.debug().FuncEnd(this.GetOneLiveTreeData.name),t}}var y=function(e,t,n,i){return new(n||(n=Promise))((function(a,o){function r(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}d((i=i.apply(e,t||[])).next())}))};class I extends s{constructor(e){super(e)}__debugDataPublishChain(e,t){return this.debug().FuncStart(this.__debugDataPublishChain.name,t),this.debug().LogVal('docToPublish',this.debug().IsNullOrUndefined(e.docToPublish)),this.debug().LogVal('jqIframe',this.debug().IsNullOrUndefined(e.jqIframe)+' '+(e.jqIframe?e.jqIframe.IframeElem.src:'')),this.debug().LogVal('Iframe0blueIframe',this.debug().IsNullOrUndefined(e.Iframe0Blue)+' '+(e.Iframe0Blue?e.Iframe0Blue.IframeElem.src:'')),this.debug().LogVal('messageDialogIframeRed',this.debug().IsNullOrUndefined(e.messageDialogIframeRed)+' '+(e.messageDialogIframeRed?e.messageDialogIframeRed.IframeElem.src:'')),this.debug().FuncEnd(this.__debugDataPublishChain.name),e}PublishCE(e){return y(this,void 0,void 0,(function*(){this.debug().FuncStart(this.PublishCE.name);var t={docToPublish:e,TopLevelDoc:this.PageMan().TopLevelWindow().DataDocSelf,Iframe0Blue:null,jqIframe:null,messageDialogIframeRed:null};yield this.PromiseOneStep().ClickPublishOnNav(t).then(e=>this.PromiseOneStep().ClickMenuButtonPublishDropDown(e)).then(e=>this.__debugDataPublishChain(e,'post ClickMenuButtonPublishDropDown')).then(e=>this.PromiseOneStep().ClickMenuDropDownPublishItem(e)).then(e=>this.__debugDataPublishChain(e,'post MenuDropDownPublishItem')).then(e=>this.PromiseOneStep().GetThePublishItemDialog(e)).then(e=>this.__debugDataPublishChain(e,'post PublishItemDialog')).then(e=>this.GetDialogIframe0Blue(e)).then(e=>this.__WaitForAndClickPublishNextButton(e)).then(e=>this.GetMessageDialog(e)).then(e=>this.__waitForAndClickOk(e)).then(e=>this.__waitForAndClickClose(e)).catch(e=>{this.debug().Error(this.PublishCE.name,e)}),this.debug().FuncEnd(this.PublishCE.name)}))}__waitForAndClickClose(e){return y(this,void 0,void 0,(function*(){return yield this.PromiseGen().WaitForAndReturnFoundElem(e.Iframe0Blue.ContentDoc,this.Const().Selector.SC.Publish.SettingsHidden).then(()=>y(this,void 0,void 0,(function*(){yield this.PromiseGen().WaitForAndReturnFoundElem(e.Iframe0Blue.ContentDoc,this.Const().Selector.SC.Publish.TheItemHasBeenPublished,this.Const().IterHelper.MaxCount.OverridePublishing)}))).then(()=>y(this,void 0,void 0,(function*(){yield this.PromiseGen().WaitForThenClick(this.Const().Selector.SC.Cancel,e.Iframe0Blue.ContentDoc)}))),e}))}__waitForAndClickOk(e){return y(this,void 0,void 0,(function*(){return yield this.PromiseGen().WaitForThenClick(this.Const().Selector.SC.Ok,e.messageDialogIframeRed.ContentDoc),e}))}__WaitForAndClickPublishNextButton(e){return y(this,void 0,void 0,(function*(){return yield this.PromiseGen().WaitForThenClick(this.Const().Selector.SC.NextButton,e.Iframe0Blue.ContentDoc),e}))}GetMessageDialog(e){return y(this,void 0,void 0,(function*(){return e.messageDialogIframeRed=yield this.PromiseGen().WaitForAndReturnReadyIframe(e.jqIframe.ContentDoc,this.Const().Selector.SC.ContentIFrame1,'iframeRed'),e}))}GetDialogIframe0Blue(e=null){return y(this,void 0,void 0,(function*(){return this.debug().FuncStart(this.GetDialogIframe0Blue.name),e.Iframe0Blue=yield this.PromiseGen().WaitForAndReturnReadyIframe(e.jqIframe.ContentDoc,this.Const().Selector.SC.ContentIframe0,'Iframe0Blue'),this.debug().DebugDataOneIframe(e.Iframe0Blue),this.debug().FuncEnd(this.GetDialogIframe0Blue.name),e}))}__waitForThenFunc(e,t,n,i){return new Promise((a,o)=>y(this,void 0,void 0,(function*(){this.debug().FuncStart(this.__waitForThenFunc.name,e),this.debug().DebugIDataDoc(t);var r=null;(r=yield this.PromiseGen().WaitForAndReturnFoundElem(t,e))?(this.debug().Log('found'),i&&(this.debug().Log('executing func'),n=yield i(r,n)),this.__debugDataPublishChain(n,this.__waitForThenFunc.name),this.debug().FuncEnd(this.__waitForThenFunc.name,e),a(n)):o('not found')})))}}var F=function(e,t,n,i){return new(n||(n=Promise))((function(a,o){function r(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}d((i=i.apply(e,t||[])).next())}))};class E extends s{constructor(e){super(e),e.debug.FuncStart(E.name),e.debug.FuncEnd(E.name)}SaveWindowState(e){this.debug().FuncStart(this.SaveWindowState.name);var t=this.PageMan().GetCurrentPageType();if(this.Xyyz.OneWindowMan.CreateNewWindowSnapShot(t),t===o.ContentEditor){this.debug().Log('is Content Editor');var n=this.Xyyz.GuidMan.EmptyGuid();this.Xyyz.OneCEMan.SaveStateOneContentEditor(n,e.DataDocSelf)}else t===o.Desktop?(this.debug().Log('is Desktop'),this.Xyyz.OneDesktopMan.SaveStateOneDesktop(e)):this.debug().Error(this.SaveWindowState.name,'Invalid page location '+t);this.debug().FuncEnd(this.SaveWindowState.name)}__getTopLevelIframe(e){var t=null,n=this.DesktopMan().GetAllLiveIframeData(e),i=-1;if(n&&n.length>0)for(var a=0;a<n.length;a++){var o=n[a];o&&o.Zindex>i&&(t=o,i=o.Zindex)}return t}PublishActiveCE(e){return F(this,void 0,void 0,(function*(){this.debug().FuncStart(this.PublishActiveCE.name);var t=null;if(this.PageMan().GetCurrentPageType()==o.Desktop){var n=this.__getTopLevelIframe(e);n&&(t=n.ContentDoc)}else t=this.PageMan().TopLevelWindow().DataDocSelf;if(this.debug().Log('docToPublish',this.debug().IsNullOrUndefined(t)),t){var i=new I(this.Xyyz);yield i.PublishCE(t)}this.debug().FuncEnd(this.PublishActiveCE.name)}))}RestoreWindowStateToTarget(e,t){return F(this,void 0,void 0,(function*(){this.debug().FuncStart(this.RestoreWindowStateToTarget.name),t&&(t.WindowType===o.ContentEditor?yield this.Xyyz.OneCEMan.RestoreCEStateAsync(t.AllCEAr[0],e.DataDocSelf):t.WindowType===o.Desktop?yield this.Xyyz.OneDesktopMan.RestoreDesktopStateAsync(e,t):this.debug().Error(this.RestoreWindowStateToTarget.name,'No match found for snap shot'),this.debug().FuncEnd(this.RestoreWindowStateToTarget.name))}))}PutCEDataToCurrentSnapShot(e){this.debug().FuncStart(this.PutCEDataToCurrentSnapShot.name),this.debug().Log('PutCEDataToCurrentSnapShot');var t=this.FindMatchingCeData(e);t?t=e:this.__activeWindowSnapShot.AllCEAr.push(e),this.UpdateStorage(),this.AtticMan().DrawDebugDataPretty(this.__activeWindowSnapShot),this.debug().FuncEnd(this.PutCEDataToCurrentSnapShot.name)}ShowDebugDataOneWindow(){this.debug().FuncStart('ShowDebugDataOneWindow');var e=[];e.push(this.__activeWindowSnapShot.TimeStamp.toJSON());for(var t=0;t<this.__activeWindowSnapShot.AllCEAr.length;t++){var n=this.__activeWindowSnapShot.AllCEAr[t];e=e.concat(this.Xyyz.OneCEMan.GetDebugDataOneCE(n))}for(var i=0;i<e.length;i++)this.debug().Log(e[i]);return this.debug().FuncEnd('ShowDebugDataOneWindow'),e}UpdateStorage(){this.debug().FuncStart(this.UpdateStorage.name),this.AtticMan().WriteToStorage(this.__activeWindowSnapShot),this.UiMan().RefreshUi(),this.debug().FuncEnd(this.UpdateStorage.name)}FindMatchingCeData(e){for(var t=null,n=0;n<this.__activeWindowSnapShot.AllCEAr.length;n++){var i=this.__activeWindowSnapShot.AllCEAr[n];if(i.Id===e.Id){t=i;break}}return this.debug().Log('match found :'+(null!==t)),t}Init(){var e=this.PageMan().GetCurrentPageType();this.CreateNewWindowSnapShot(e)}CreateNewWindowSnapShot(e){this.debug().FuncStart('CreateNewWindowSnapShot');var t=new Date,n=this.Xyyz.GuidMan.NewGuid();this.__activeWindowSnapShot={TimeStamp:t,WindowType:e,WindowFriendly:e[e],AllCEAr:[],Id:n,IsFavorite:!1,NickName:'',RawData:null},this.debug().FuncEnd('CreateNewWindowSnapShot')}}var M=function(e,t,n,i){return new(n||(n=Promise))((function(a,o){function r(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}d((i=i.apply(e,t||[])).next())}))};class k extends s{constructor(e){super(e),this.debug().CtorName(this.constructor.name)}GetTargetWindowAsync(e,t){return M(this,void 0,void 0,(function*(){var n;if(this.debug().FuncStart(this.GetTargetWindowAsync.name),e)this.debug().Log('target window is self'),n=this.TopLevelWindow();else{this.debug().Log('target window is new');let e=this.__getUrlForWindowType(t);yield this.__getNewTargetWindowAsync(e).then(e=>n=e)}return this.debug().FuncEnd(this.GetTargetWindowAsync.name,'child window id: '+n.DataDocSelf.XyyzId.asShort),n}))}__getNewTargetWindowAsync(e){return M(this,void 0,void 0,(function*(){return new Promise(t=>{this.debug().FuncStart(this.__getNewTargetWindowAsync.name),this.debug().LogVal('newWindowUrl',e);var n=this.__winDataParent.Window.open(e),i=this;n.addEventListener('load',()=>{var e=i.SetWindowDataToCurrent(n,'newly spawned window');t(e)}),this.debug().FuncEnd(this.__getNewTargetWindowAsync.name)})}))}SetWindowDataToCurrent(e,t){var n={Friendly:'New Tab',Window:e,WindowType:o.Unknown,DataDocSelf:{ParentDoc:null,Document:e.document,HasParentDesktop:!1,XyyzId:this.GuidMan().NewGuid(),IsCEDoc:!1,ParentDesktop:null,Nickname:t}};return n.DataDocSelf.ParentDoc=n.DataDocSelf,n}TopLevelWindow(){return console.log('marker c'),this.__winDataParent}Init(){this.debug().FuncStart(this.Init.name),window.opener?(this.__winDataParent={Window:window.opener,Friendly:'Parent Window',WindowType:o.Unknown,DataDocSelf:{ParentDoc:null,Document:window.opener.document,HasParentDesktop:!1,XyyzId:this.GuidMan().NewGuid(),IsCEDoc:!1,ParentDesktop:null,Nickname:'Original Target Page'}},this.__winDataParent.DataDocSelf.ParentDoc=this.__winDataParent.DataDocSelf):this.debug().Error(this.constructor.name,'No Opener Page'),this.UiMan().SetParentInfo(this.__winDataParent),this.debug().FuncEnd(this.Init.name)}GetPageTypeOfTargetWindow(e){var t;this.debug().FuncStart(this.GetPageTypeOfTargetWindow.name,e.location.href);var n=e.location.href;return n.indexOf(this.Const().UrlSuffix.Login)>-1?t=o.LoginPage:n.toLowerCase().indexOf(this.Const().UrlSuffix.Desktop.toLowerCase())>-1?(this.debug().Log('Testing for Desktop editor'),this.debug().Log('currentLoc.toLowerCase()'+n.toLowerCase()),this.debug().Log('this.Const().Url.Desktop.toLowerCase()'+this.Const().UrlSuffix.Desktop.toLowerCase()),t=o.Desktop):t=new RegExp(this.Const().Regex.ContentEditor).test(n)?o.ContentEditor:n.toLowerCase().indexOf(this.Const().UrlSuffix.LaunchPad.toLowerCase())>-1?o.Launchpad:o.Unknown,this.debug().FuncEnd(this.GetPageTypeOfTargetWindow.name,o[t]),t}__getUrlForWindowType(e){var t;this.debug().NotNullCheck('this.__winDataParent.DataDocSelf.Document',this.__winDataParent.DataDocSelf.Document);var n=this.__winDataParent.DataDocSelf.Document.location.origin;switch(e){case o.ContentEditor:t=n+this.Const().UrlSuffix.CE;break;case o.Desktop:t=n+this.Const().UrlSuffix.Desktop;break;case o.Edit:case o.Preview:case o.Normal:t=n+this.Const().UrlSuffix.None;break;default:t=n,this.debug().Error(this.__getUrlForWindowType.name,'unaccounted for window type')}return t}GetCurrentPageType(){this.debug().FuncStart(this.GetCurrentPageType.name);var e=o.Unknown;return this.__winDataParent&&this.__winDataParent&&this.__winDataParent.Window&&this.__winDataParent.DataDocSelf&&(e=this.GetPageTypeOfTargetWindow(this.__winDataParent.Window)),this.debug().FuncEnd(this.GetCurrentPageType.name+' ('+e+') '+o[e]),e}DebugInfo(){this.debug().FuncStart(this.DebugInfo.name),this.debug().Log(this.__winDataParent.Window),this.debug().Log(this.__winDataParent.DataDocSelf),this.debug().FuncEnd(this.DebugInfo.name)}}var N=function(e,t,n,i){return new(n||(n=Promise))((function(a,o){function r(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}d((i=i.apply(e,t||[])).next())}))};class P extends s{constructor(e){e.debug.FuncStart(P.name),super(e),e.debug.FuncEnd(P.name)}WaitForReadyIframe(e){return N(this,void 0,void 0,(function*(){return new Promise(t=>N(this,void 0,void 0,(function*(){this.debug().FuncStart(this.WaitForReadyIframe.name,e.Nickname+' '+e.Id.asShort),this.debug().DebugDataOneIframe(e);var n=new f(this.Xyyz,this.WaitForReadyIframe.name),i=!1;for(this.debug().MarkerA();n.DecrementAndKeepGoing()&&!i;){this.debug().MarkerB();var a=e.IframeElem.contentDocument.readyState.toString(),o='complete'===a;this.debug().Log('currentReadyState : '+a),this.debug().MarkerC(),this.debug().Log('isReadyStateComplete: '+o),o?(this.debug().Log('toReturn A is true'),i=!0,e.ContentDoc=this.Utilites().DataOneContentDocFactoryFromIframe(e.IframeElem,e.ContentDoc.ParentDoc,e.Nickname)):yield n.Wait()}this.debug().DebugDataOneIframe(e),this.debug().FuncEnd(this.WaitForReadyIframe.name,e.Nickname+' : '+a+' is ready: '+i.toString()),t(e)})))}))}WaitForAndReturnReadyIframe(e,t,n){return N(this,void 0,void 0,(function*(){return new Promise(i=>N(this,void 0,void 0,(function*(){var a;yield this.WaitForAndReturnFoundElem(e,t).then(t=>N(this,void 0,void 0,(function*(){if(t)return a=this.Utilites().DateOneIframeFactory(t,e,n),this.debug().DebugDataOneIframe(a),a}))).then(e=>N(this,void 0,void 0,(function*(){e=yield this.PromiseGen().WaitForReadyIframe(e),i(e)})))})))}))}WaitForAndReturnFoundElem(e,t,n=8){return N(this,void 0,void 0,(function*(){return new Promise((i,a)=>N(this,void 0,void 0,(function*(){this.debug().FuncStart(this.WaitForAndReturnFoundElem.name,'selector: '+t+' nickname: '+e.Nickname);for(var o=null,r=new f(this.Xyyz,this.WaitForAndReturnFoundElem.name,n);!o&&r.DecrementAndKeepGoing();)this.debug().LogVal('targetDoc.Document',e.Document.toString()),this.debug().LogVal('targetDoc.Document.location',e.Document.location.toString()),this.debug().LogVal('targetDoc.Document.location.href',e.Document.location.href),(o=e.Document.querySelector(t))?(this.debug().Log('found'),this.debug().LogVal('found.style.display',o.style.display),this.debug().FuncEnd(this.WaitForAndReturnFoundElem.name,t+e.Document.location.href),i(o)):yield r.Wait();!o&&r.IsExhausted&&(this.debug().FuncEnd(this.WaitForAndReturnFoundElem.name,t+e.Document.location.href),a('exhausted'))})))}))}WaitForPageReadyNative(e){return N(this,void 0,void 0,(function*(){return new Promise((t,n)=>N(this,void 0,void 0,(function*(){this.debug().FuncStart(this.WaitForPageReadyNative.name);new f(this.Xyyz,this.WaitForThenClick.name,5);this.MiscMan().NotNullOrUndefined(e,this.WaitForPageReadyNative.name+' document')})))}))}WaitForAndClickWithPayload(e,t,n){return new Promise((i,a)=>N(this,void 0,void 0,(function*(){this.debug().FuncStart(this.WaitForAndClickWithPayload.name,e),yield this.PromiseGen().WaitForThenClick(e,t).then(()=>i(n)).catch(e=>{this.debug().Error(this.WaitForAndClickWithPayload.name,e),a(e)})})))}WaitForPageReady(e){return N(this,void 0,void 0,(function*(){return new Promise((t,n)=>N(this,void 0,void 0,(function*(){this.debug().FuncStart(this.WaitForPageReady.name),this.debug().NotNullCheck('toReturn',e),this.debug().NotNullCheck('toReturn',e.DataDocSelf),this.debug().NotNullCheck('toReturn',e.DataDocSelf.Document),this.debug().NotNullCheck('toReturn',e.DataDocSelf.Document.location),this.debug().NotNullCheck('toReturn',e.DataDocSelf.Document.location.href),this.debug().LogVal('targetWindow.DataDocSelf.Document.location.href',e.DataDocSelf.Document.location.href),e&&(yield this.WaitForPageReadyNative(e).then(()=>t()).catch(e=>{n(e)})),this.debug().FuncEnd(this.WaitForPageReady.name)})))}))}RaceWaitAndClick(e,t,n=null){return N(this,void 0,void 0,(function*(){this.debug().FuncStart(this.RaceWaitAndClick.name);var i=this.WaitForThenClick(e.sc920,t,n),a=this.WaitForThenClick(e.sc820,t,n);return this.debug().FuncEnd(this.RaceWaitAndClick.name),yield Promise.race([i,a])}))}WaitForThenClick(e,t,n=null){return new Promise((i,a)=>N(this,void 0,void 0,(function*(){if(t){this.debug().FuncStart(this.WaitForThenClick.name,e);for(var o=null,r=new f(this.Xyyz,this.WaitForThenClick.name);!o&&r.DecrementAndKeepGoing()&&!this.UiMan().OperationCancelled;)(o=t.Document.querySelector(e))?(this.debug().Log('found and clicking'),o.click(),this.debug().FuncEnd(this.WaitForThenClick.name,e),n&&n(),i()):yield r.Wait()}else a();this.debug().FuncEnd(this.WaitForThenClick.name,e),!o&&r.IsExhausted&&a('exhausted')})))}}var A=function(e,t,n,i){return new(n||(n=Promise))((function(a,o){function r(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}d((i=i.apply(e,t||[])).next())}))};class T extends s{constructor(e){e.debug.FuncStart(P.name),super(e),e.debug.FuncEnd(P.name)}ClickPublishOnNav(e){return A(this,void 0,void 0,(function*(){return yield this.PromiseGen().WaitForThenClick(this.Const().Selector.SC.NavPublishStrip,e.docToPublish),e}))}ClickMenuButtonPublishDropDown(e=null){return A(this,void 0,void 0,(function*(){return yield this.PromiseGen().WaitForThenClick(this.Const().Selector.SC.MenuButtonPublish,e.docToPublish),e}))}ClickMenuDropDownPublishItem(e=null){return A(this,void 0,void 0,(function*(){return yield this.PromiseGen().WaitForAndClickWithPayload(this.Const().Selector.SC.MenuDropDownPublishItem,e.docToPublish,e)}))}GetThePublishItemDialog(e=null){return A(this,void 0,void 0,(function*(){return yield this.PromiseGen().WaitForAndReturnFoundElem(e.TopLevelDoc,this.Const().Selector.SC.JqueryModalDialogsFrame).then(t=>(e.jqIframe=this.Utilites().DateOneIframeFactory(t,e.docToPublish.ParentDoc,'jqIframe'),e)).then(t=>A(this,void 0,void 0,(function*(){yield this.PromiseGen().WaitForReadyIframe(t.jqIframe),e=t}))),e}))}}class O extends s{constructor(e){super(e),this.__selectSnapshotIndex=0,this.ParentFocused=!1,this.MenuFocused=!0,this.OtherFocused=!1,this.MenuEnabled=!0,e.debug.FuncStart(O.name),e.debug.FuncEnd(O.name)}Init(){this.debug().AddDebugTextChangedCallback(this,this.HndlrDebugTextChanged);var e=this.AtticMan().CurrentSettings().MenuPrefs;if(e.MenuX&&e.MenuY){var t=window.screenLeft,n=window.screenTop;Math.abs(e.MenuX-t),Math.abs(e.MenuY-n);window.moveTo(Math.abs(e.MenuX),Math.abs(e.MenuY))}e.MenuWidth&&e.MenuHeight&&(e.MenuHeight<this.Const().Numbers.MinMenuHeight&&(e.MenuHeight=this.Const().Numbers.MinMenuHeight),e.MenuWidth<this.Const().Numbers.MinMenuWidth&&(e.MenuWidth=this.Const().Numbers.MinMenuWidth),window.resizeTo(Math.abs(e.MenuWidth),Math.abs(e.MenuHeight))),this.__wireParentFocusCheck(),this.RefreshUi()}__wireParentFocusCheck(){this.PageMan().TopLevelWindow().DataDocSelf.Document.addEventListener('focus',()=>{this.OnParentFocused(!0)}),this.PageMan().TopLevelWindow().DataDocSelf.Document.addEventListener('blur',()=>{this.OnParentFocused(!1)}),window.addEventListener('focus',()=>{this.OnMenuFocused(!0)}),window.addEventListener('blur',()=>{this.OnMenuFocused(!1)})}OnParentFocused(e){this.ParentFocused=e,this.CalculateMenuDisplay()}OnMenuFocused(e){this.MenuFocused=e,this.CalculateMenuDisplay()}CalculateMenuDisplayDelayed(e){e.ParentFocused||e.MenuFocused||(e.OtherFocused=!0),e.ParentFocused&&(e.OtherFocused=!1),e.MenuEnabled=!e.OtherFocused&&(e.ParentFocused||e.MenuFocused);var t=document.querySelector(e.Const().Selector.HS.menuOverlay);t&&(e.MenuEnabled?t.style.display='none':t.style.display='')}CalculateMenuDisplay(){var e=this;setTimeout(()=>{this.CalculateMenuDisplayDelayed(e)},100),setTimeout(()=>{this.CalculateMenuDisplayDelayed(e)},1e3)}WriteTabId(){this.TabId=(new Date).getTime().toString(),this.WriteDocIdTo(this.PageMan().TopLevelWindow().Window.document,this.TabId)}WriteDocIdTo(e,t){if(this.debug().FuncStart(this.WriteDocIdTo.name,t),e){this.RemoveExistingTabId(e);var n=e.createElement('div');n.id=this.Const().ElemId.HS.TabId,n.innerText=t,e.body.appendChild(n)}else this.debug().Error(this.WriteDocIdTo.name,'no target window');this.debug().FuncEnd(this.WriteDocIdTo.name,t.toString())}RemoveExistingTabId(e){var t=e.querySelector(this.Utilites().MakeSelectorFromId(this.Const().ElemId.HS.TabId));t&&e.removeChild(t)}VerifyTabMatch(){}__getTextArea(){return document.getElementById(this.Const().ElemId.HS.TaDebug)}HndlrDebugTextChanged(e,t){var n=e.__getTextArea();n&&(t.Append?n.value+=t.NewText+'\n':n.value=t.NewText+'\n',n.scrollTop=n.scrollHeight)}SetParentInfo(e){var t=document.getElementById(this.Const().ElemId.HindSiteParentInfo);t&&(t.innerHTML=' | Parent Id: '+this.GuidMan().ShortGuid(e.DataDocSelf.XyyzId)+' | '+e.Window.location.href)}NotifyComplete(e=null,t=this.Const().Notify.Default){e||(e=this.PageMan().TopLevelWindow());let n=e.DataDocSelf.Document.getElementsByTagName('body')[0];var i=e.DataDocSelf.Document.createElement('div');i.innerHTML='<div>'+t+'</div>',i.style.position='absolute',i.style.top='100px',i.style.left='100px',i.style.backgroundColor='yellow',i.style.zIndex='999',i.style.fontSize='40px',setTimeout((function(){i.remove(),window.close()}),this.Const().Timeouts.WaitBeforeRemovingCompleteFlag),n.appendChild(i)}SetAccordianClass(e,t){t?e.classList.add(this.Const().ClassNames.HS.Collapsed):e.classList.remove(this.Const().ClassNames.HS.Collapsed)}GetAccordianContentElem(e){if(e){var t=e.parentElement.getElementsByClassName('accordian-content');if(t)var n=t[0]}return n}RestoreAccordianStates(){for(var e=this.AtticMan().CurrentSettings().Accordian,t=0;t<e.length;t++){var n=e[t],i=document.getElementById(n.ElemId);if(i){var a=this.GetAccordianContentElem(i);a&&this.SetAccordianClass(a,n.isCollapsed)}}}UpdateAtticFromUi(){this.debug().FuncStart(this.UpdateAtticFromUi.name);let e=this.AtticMan().CurrentSettings(),t=document.querySelector(this.Const().Selector.HS.iCBoxdSettingsShowDebugData).checked;this.debug().LogVal('currentVal',t.toString()),e.DebugSettings.ShowDebugData=t,this.AtticMan().StoreSettings(e),this.RefreshUi(),this.debug().FuncEnd(this.UpdateAtticFromUi.name)}SelectChanged(){this.debug().FuncStart(this.SelectChanged.name),this.__selectSnapshotIndex=this.__getSelectElem().selectedIndex,this.debug().Log('new index :'+this.__selectSnapshotIndex),this.RefreshUi(),this.debug().FuncEnd(this.SelectChanged.name)}__GetCancelButton(){return document.getElementById(this.Const().ElemId.HS.Btn.Cancel)}SetCancelFlag(){this.OperationCancelled=!0;var e=this.__GetCancelButton();e&&e.classList.add('red')}ClearCancelFlag(){var e=this.__GetCancelButton();e&&e.classList.remove('red'),this.UiMan().OperationCancelled=!1}__refreshSettings(){this.debug().FuncStart(this.__refreshSettings.name);let e=window.document.querySelector(this.Const().Selector.HS.IdFieldSetDebug),t=this.AtticMan().CurrentSettings();if(t){if(e){let t=this.AtticMan().CurrentSettings().DebugSettings.ShowDebugData?'':'none';e.style.display=t}let n=window.document.querySelector(this.Const().Selector.HS.iCBoxdSettingsShowDebugData);n?(this.debug().LogVal('before',n.checked.toString()),n.checked=t.DebugSettings.ShowDebugData,this.debug().LogVal('after',n.checked.toString())):this.debug().Error(this.RefreshUi.name,'no checkbox found')}else this.debug().Error(this.RefreshUi.name,'no settings found');this.debug().FuncEnd(this.__refreshSettings.name)}RefreshUi(){this.debug().FuncStart(this.__drawCorrectNicknameInUI.name),this.__populateStateSel(),this.__drawCorrectNicknameInUI(),this.__refreshSettings(),this.RestoreAccordianStates(),this.debug().FuncEnd(this.__drawCorrectNicknameInUI.name)}__drawCorrectNicknameInUI(){this.debug().FuncStart(this.__drawCorrectNicknameInUI.name);var e=this.UiMan().GetIdOfSelectWindowSnapshot();if(e){this.debug().Log('targetId : '+e.asString);var t=this.AtticMan().GetFromStorageById(e);if(t){var n=window.document.getElementById(this.Const().ElemId.InputNickname);n&&(n.value=t.NickName)}}this.debug().FuncEnd(this.__drawCorrectNicknameInUI.name)}GetValueInNickname(){return window.document.getElementById(this.Const().ElemId.InputNickname).value}__getSelectElem(){return window.document.getElementById(this.Const().ElemId.HS.SelStateSnapShot)}GetIdOfSelectWindowSnapshot(){this.debug().FuncStart(this.GetIdOfSelectWindowSnapshot.name);var e=this.__getSelectElem(),t=null;if(e){var n=e.options.length;if(this.__selectSnapshotIndex<n){var i=e.options[this.__selectSnapshotIndex].value;t=this.GuidMan().ParseGuid(i),this.debug().LogVal('toReturn',t.asString)}}return this.debug().FuncEnd(this.GetIdOfSelectWindowSnapshot.name),t}__populateStateSel(){this.debug().FuncStart(this.__populateStateSel.name,this.__selectSnapshotIndex.toString());var e=this.__getSelectElem();if(e){var t=window.document.createElement('optgroup');t.label=this.Utilites().SelectHeaderStr();var n=this.AtticMan().GetAllStorageAsIDataOneWindow();if(n&&n.length>0){e.options.length=0,this.debug().Log('targetSel.options.length : '+e.options.length);for(var i=0;i<n.length;i++){var a=n[i],o=window.document.createElement('option');o.innerHTML=this.Xyyz.Utilities.TimeNicknameFavStr(a),o.value=a.Id.asString,i===this.__selectSnapshotIndex&&(o.selected=!0),t.appendChild(o)}}e.appendChild(t)}this.debug().FuncEnd(this.__populateStateSel.name)}}class W extends s{SelectHeaderStr(){let e='';return e+=this.Buffer('...Time Stamp',23,'.',!1),e+=this.Buffer('- Page Type',20,'.',!1,!1),e+=this.Buffer('- Nickname',16,'.',!1,!1),e+=this.Buffer('- Fav.',4,'.',!1),e}MakeSelectorFromId(e){return'[id='+e+']'}DateOneIframeFactory(e,t,n){return{Index:-1,IframeElem:e,Id:this.GuidMan().NewGuid(),Zindex:e.style.zIndex?parseInt(e.style.zIndex):-1,Nickname:n,ContentDoc:this.DataOneContentDocFactoryFromIframe(e,t,n)}}DataOneContentDocFactoryFromIframe(e,t,n){return{ParentDoc:t,Document:e.contentDocument,HasParentDesktop:!1,XyyzId:this.GuidMan().NewGuid(),IsCEDoc:!1,ParentDesktop:null,Nickname:n+' - content doc'}}TimeNicknameFavStr(e){var t=e.WindowType===o.Unknown?'?':o[e.WindowType];return this.MakeFriendlyDate(e.TimeStamp)+' - '+this.Buffer(t,17,' ',!1)+' - '+this.Buffer(e.NickName,16,' ',!1)+' - '+this.Buffer(e.IsFavorite?'*':' ',1)}constructor(e){super(e),e.debug.FuncStart(W.name),e.debug.FuncEnd(W.name)}Buffer(e,t,n=' ',i=!0,a=!0){var o=e;if(0===n.length&&(n=' '),o.length>t&&(o=t>6?o.substring(0,t-3)+'...':o.substring(0,t)),o.length<t){var r=t-o.length;' '===n&&a&&(n='&nbsp;');for(var s=0;s<r;s++)i?o=n+o:o+=n}return o}MakeFriendlyDate(e){var t=e.getFullYear(),n=e.getMonth(),i=this.Utilites().Buffer(e.getDay().toString(),2,'0'),a=this.Utilites().Buffer(e.getMinutes().toString(),2,'0'),o=e.getHours(),r=o>=12?'pm':'am',s=(o%=12)||12;return t+'.'+n+'.'+i+' '+this.Utilites().Buffer(s.toString(),2,'0')+':'+a+' '+r}}class L{constructor(e,t){t.FuncStart(L.name),this.debug=t,this.SitecoreUiMan=e,this.Start(),t.FuncEnd(L.name)}Start(){this.debug.FuncStart(this.Start.name),this.AtticMan=new d(this),this.EventMan=new h(this),this.FeedbackMan=new l(this),this.GuidMan=new c(this),this.LocationMan=new m(this),this.MiscMan=new S(this),this.OneCEMan=new D(this),this.OneDesktopMan=new _(this),this.OneTreeMan=new p(this),this.OneWindowMan=new E(this),this.PageMan=new k(this),this.PromiseGeneric=new P(this),this.PromiseOneStep=new T(this),this.UiMan=new O(this),this.Utilities=new W(this),this.init(),this.debug.FuncEnd(this.Start.name)}init(){this.debug.FuncStart(L.constructor.name+' '+this.init.name),this.Const=r.const,this.AtticMan.Init(),this.debug.Enabled=this.AtticMan.CurrentSettings().DebugSettings.ShowDebugData,this.EventMan.Init(),this.PageMan.Init(),this.OneWindowMan.Init(),this.UiMan.Init(),this.debug.FuncEnd(L.constructor.name+' '+this.init.name)}}var x=x||{};let R=new class{constructor(e){this.Enabled=!1,this.__debugTextChangedCallbacks=[],this.debugPrefix='\t\t',this.__indentCount=0,this.ParentWindow=e}DebugIDataDoc(e){this.FuncStart(this.DebugIDataDoc.name),this.Log(''),this.Log(this.debugPrefix+this.DebugIDataDoc.name),e?(this.Log(this.debugPrefix+'dataOneDoc: \t'+this.IsNullOrUndefined(e)),this.Log(this.debugPrefix+'dataOneDoc.XyyzId.asShort: \t'+this.IsNullOrUndefined(e.XyyzId.asShort)),this.Log(this.debugPrefix+'dataOneDoc.Document: \t'+this.IsNullOrUndefined(e.Document)),e.Document?(this.LogVal(this.debugPrefix+'dataOneDoc.Document.readyState:',e.Document.readyState),e.Document.location?this.LogVal(this.debugPrefix+'targetDoc.location.href',e.Document.location.href):this.Log(this.debugPrefix+'dataOneDoc.Document.location - does not exist')):this.Log(this.debugPrefix+'dataOneDoc.Document - does not exist')):this.Error(this.DebugIDataDoc.name,'no targetDoc'),this.Log('')}AddDebugTextChangedCallback(e,t){this.__debugTextChangedCallbacks.push({Caller:e,Func:t})}HndlrClearDebugText(e,t=!1){var n=!0;if(t&&(n=confirm('Clear Debug TextArea ?')),console.log('maker pink'),n){e.__triggerAllDebugTextChangedCallbacks({NewText:'--- Debug Text Reset ---',Append:!1})}}MarkerA(){this.__markerRaw('A')}MarkerB(){this.__markerRaw('B')}MarkerC(){this.__markerRaw('C')}MarkerD(){this.__markerRaw('D')}MarkerE(){this.__markerRaw('E')}__markerRaw(e){this.Log('Marker '+e)}LogVal(e,t){this.Log(e+' : '+t)}Log(e,t='',n=!1){if(this.Enabled){for(var i=0;i<this.__indentCount;i++)e='  '+e;if(!n)for(i=0;i<3;i++)e=' '+e;this.__triggerAllDebugTextChangedCallbacks({NewText:e,Append:!0}),console.log(e),this.ParentWindow&&this.ParentWindow.console.log(e)}}__triggerAllDebugTextChangedCallbacks(e){for(var t=0;t<this.__debugTextChangedCallbacks.length;t++){var n=this.__debugTextChangedCallbacks[t];n.Func(n.Caller,e)}}CtorName(e){this.Log('Constructor: '+e)}FuncStart(e,t){e='s) '+e,(t=t?t.toString():'').length>0&&(e=e+' : '+t),this.Log(e,'',!0),this.__indentCount++,this.__indentCount>10&&(this.__indentCount=10)}FuncEnd(e,t=''){e='e) '+e,t.length>0&&(e=e+' : '+t),this.__indentCount--,this.__indentCount<0&&(this.__indentCount=0),this.Log(e,t,!0)}Error(e,t){e||(e='unknown'),t||(t='unknown'),this.Log(''),this.Log('\t\t** ERROR ** '+e),this.Log(''),this.Log('\t\t  '+t),this.Log(''),this.Log('\t\t** ERROR ** '+e),this.Log('')}NotNullCheck(e,t){void 0===t?this.LogVal(e,'Is Undefined'):t?this.LogVal(e,'Is Not Null'):this.LogVal(e,'Is Null')}IsNullOrUndefined(e){return e?void 0===e?'Is Undefined':'Not Null':'Is Null'}PromiseBucketDebug(e,t){this.FuncStart(this.PromiseBucketDebug.name,t),this.Log('promiseBucket : '+this.IsNullOrUndefined(e)),e&&void 0!==e&&(this.Log('promiseBucket.IFramesbefore: '+this.IsNullOrUndefined(e.IFramesbefore)),this.Log('promiseBucket.targetWindow: '+this.IsNullOrUndefined(e.targetWindow)),this.Log('promiseBucket.oneCEdata: '+this.IsNullOrUndefined(e.oneCEdata)),this.Log('promiseBucket.NewIframe: '+this.IsNullOrUndefined(e.NewIframe)),e.NewIframe&&this.DebugDataOneIframe(e.NewIframe)),this.FuncEnd(this.PromiseBucketDebug.name,t)}DebugDataOneIframe(e){this.FuncStart(this.DebugDataOneIframe.name),this.Log('dataOneIframe : '+this.IsNullOrUndefined(e)),e&&(this.Log('dataOneIframe.Nickname : '+e.Nickname),this.Log('dataOneIframe.IframeElem: \t'+this.IsNullOrUndefined(e.IframeElem)),e.IframeElem&&this.Log('dataOneIframe.id: \t'+this.IsNullOrUndefined(e.IframeElem.id)),this.Log('dataOneIframe.ContentDoc: \t'+this.IsNullOrUndefined(e.ContentDoc)),this.DebugIDataDoc(e.ContentDoc)),this.FuncEnd(this.DebugDataOneIframe.name)}}(window.opener),B=new i(R);x.HubObj=new L(B,R)}]);";
    var PopUpStyles = ".icon{background-repeat:no-repeat;background-position:top}.restore-snapshot{background-image:url('/~/icon/core3/32x32/open_document.png')}.delete-snapshot{background-image:url('/~/icon/applicationsv2/32x32/delete.png')}.favorite{background-image:url('/~/icon/applicationsv2/32x32/heart.png')}.edit{background-image:url('/~/icon/apps/32x32/Paint.png')}.normal{background-image:url('/~/icon/network/32x32/web.png')}.preview-icon{background-image:url(/~/icon/apps/32x32/Preview.png)}.admin-b{background-image:url(/~/icon/office/32x32/log_in.png)}.desktop-icon{background-image:url(/temp/iconcache/apps/48x48/windows%20table.png)}.ce{background-image:url(/temp/iconcache/apps/48x48/pencil.png)}.add-ce-tab{background-image:url(/~/icon/applicationsv2/32x32/add.png)}.details{background-image:url(/temp/iconcache/office/24x24/layout_details.png)}.take-snapshot{background-image:url('/~/icon/apps/32x32/Camera (1).png')}.publish{background-image:url(/temp/iconcache/office/24x24/publish.png)}.cancel{background-image:url(/~/icon/applicationsv2/32x32/sign_stop.png)}.draw-storage{background-image:url(/~/icon/office/32x32/store.png)}.set-nickname{background-image:url(/~/icon/core/32x32/rename.png)}.light-text{color:#ccc}.red{background-color:red}.admin-b-icon{background-image:url(/~/icon/office/32x32/log_in.png);background-repeat:no-repeat;background-position:top}button{background:none;background-color:#fff;background-size:30px 30px;border:0;border-radius:0px;box-shadow:none;cursor:pointer;height:96px;height:60px;margin:7px;padding-top:26px;vertical-align:top;white-space:normal;width:96px;word-wrap:break-word}button:hover{background-color:#E3E3E3}select{width:100%;font-family:Courier New, Courier, monospace}.mono{font-family:Courier New, Courier, monospace}.mono div{border:0;margin:0;padding:0}fieldset{display:flex;flex-wrap:wrap;background-color:#f7f7f7;padding-top:14px}.accordian-content{display:flex}legend{background:none;background-color:#474747;border:none;color:white;cursor:pointer;display:flex;float:left;left:-12px;margin-top:0;padding-top:0;position:relative;top:-12px;width:100%}legend:after{content:url('/sitecore/shell/themes/standard/Images/accordion_up.png');font-size:13px;color:#777;float:right;margin-left:5px}option{color:black;font-family:Courier New, Courier, monospace}optgroup{color:#ccc;font-family:Courier New, Courier, monospace}.col-6{display:flex;flex-wrap:wrap;width:600px;align-content:flex-start}.in{display:none}.col-6-btn{display:flex;flex-wrap:wrap;float:right;width:252px}.group{border:1px solid lightgray;display:flex;margin:4px;padding:4px;vertical-align:top}body{background-image:url(/sitecore/login/drop_wallpaper.jpg);background-size:cover;background-color:#f7f7f7;overflow:auto;color:#131313;background-repeat:no-repeat}.col-full{width:100%}.col-left{display:flex;vertical-align:top;width:75%}.ta-wrapper{width:60%;display:inline-block}.ta-wrapper .ta-feedback{height:100px;display:inline-block;width:auto}.scroller{height:160px;display:inline-block;width:800px;overflow:scroll}.menu-overlay{bottom:0;left:0;position:absolute;right:0;top:0;z-index:999}.menu-overlay .overlay-gray{background-color:#474747;bottom:0;left:0;opacity:0.8;position:absolute;right:0;top:0}.menu-overlay .overlay-solid{background:white;border:5px solid black;margin:auto auto;padding:20px;position:relative;top:50px;width:60%}textarea{border:0;box-sizing:border-box;display:inline-block;height:160px;overflow-x:hidden;overflow-y:auto;padding:0;width:1500px;white-space:pre-wrap}";
    var xyyz, constants = { taDebug: "ta-debug" }; (xyyz = xyyz || {}).ChildWindow = { myWindow: null, WindowExists: function () { return this.mywindow && "undefined" !== this.mywindow && !this.mywindow.closed }, CreateWindow: function () { console.log("new window"), window.mywindow = window.open("", "mywindow", "width=900, height=900") }, FocusWindow: function () { console.log("existing window"), window.mywindow.focus() } }, xyyz.ChildWindow.WindowExists() ? xyyz.ChildWindow.FocusWindow() : xyyz.ChildWindow.CreateWindow(), console.log("Menu Finished"), (xyyz = xyyz || {}).ChildWindow = { myWindow: null, WindowExists: function () { return this.mywindow && "undefined" !== this.mywindow && !this.mywindow.closed }, WriteHtml: function (o) { console.log(o); console.log("s) WriteHtml"); var n = "<head>"; n += "<style>", console.log("Marker A"), n += PopUpStyles, n += "</style>", n += "<body>", console.log("Marker B"), n += PopUp, n += "<script>", console.log("Marker C"), n += jsContent, n += "<\/script>", n += "</body>", console.log("Marker D"), o.document.write(n), console.log("e) WriteHtml") }, CreateWindow: function () { console.log("new window"), console.log("Constants: " + constants.taDebug); var o = window.open("", "mywindow", "width=400, height=800"); window.mywindow = o; var n = (new Date).getTime(); console.log('dddd'); this.WriteHtml(window.mywindow, n) }, FocusWindow: function () { console.log("existing window"), window.mywindow.focus() } }, xyyz.ChildWindow.WindowExists() ? xyyz.ChildWindow.FocusWindow() : xyyz.ChildWindow.CreateWindow(), console.log("Menu Finished");

    console.log('Menu Finished');

    TestDog();
  }

  browser.runtime.onMessage.addListener((message) => {
    if (message.command === "addAsHindSiteTarget") {
      addAsHindSiteTarget();
    }
    else if (message.command === "removeAsHindSiteTarget") {
      removeAsHindSiteTarget();
    }
    else if (message.command === "doHindSite") {
      doAsHindSiteTarget();
    }
  });
})();