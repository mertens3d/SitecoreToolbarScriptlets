!function(e){var t={};function n(i){if(t[i])return t[i].exports;var a=t[i]={i:i,l:!1,exports:{}};return e[i].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(i,a,function(t){return e[t]}.bind(null,a));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=1)}([function(e,t){},function(e,t,n){"use strict";n.r(t);class i{constructor(e){e.FuncStart(i.name),this.debug=e,e.FuncEnd(i.name)}AssignMenuWindowChanged(e){window.addEventListener("click",t=>{e()}),window.addEventListener("resize",t=>{e()})}}var a,o;!function(e){e[e.Unknown=0]="Unknown",e[e.Edit=1]="Edit",e[e.Preview=2]="Preview",e[e.Normal=3]="Normal"}(a||(a={}));class r{}r.ContConst={Iterations:{MaxSetHrefEffort:10,MaxIterationSwitchBoard:20},Timeouts:{PostLoginBtnClick:1e3,SetHrefEffortWait:1e3,WaitBeforeRemovingCompleteFlagOnContent:1500},IterHelper:{GrowthPerIteration:.5,MaxCount:{Default:10,OverridePublishing:15},Timeouts:{Max:1e4,Default:100}},ElemId:{sc:{scLoginUserName:"UserName",scLoginPassword:"Password",SitecoreRootNodeId:"Tree_Node_11111111111111111111111111111111",SitecoreRootGlyphId:"Tree_Glyph_11111111111111111111111111111111",scLoginBtn:{sc920:"LogInBtn",sc820:null}}},ClassNames:{ContentTreeNode:"scContentTreeNode",SC:{scContentTreeNodeActive:"scContentTreeNodeActive"}},UrlSuffix:{Desktop:"/sitecore/shell/default.aspx",Login:"/sitecore/login",LaunchPad:"/client/applications/launchpad",CE:"/sitecore/shell/Applications/Content Editor.aspx?sc_bw=1",None:"/"},Regex:{ContentEditor:/Content.*?Editor/gi},ScMode:{edit:{asEnum:a.Edit,asString:"edit"},normal:{asEnum:a.Normal,asString:"normal"},preview:{asEnum:a.Preview,asString:"preview"}},Selector:{SC:{ContentTreeNodeGlyph:".scContentTreeNodeGlyph",IdStartsWithTreeNode:"[id^=Tree_Node_]",IframeContent:"iframe[src*=content]",JqueryModalDialogsFrame:"[id=jqueryModalDialogsFrame]",ContentIframe0:"[id=scContentIframeId0]",NextButton:"[id=NextButton]",ContentIFrame1:"[id=scContentIframeId1]",Ok:"[id=OK]",Cancel:"[id=CancelButton]",MenuButtonPublish:"[id=B414550BADAF4542C9ADF44BED5FA6CB3E_menu_button]",MenuDropDownPublishItem:"[id=B414550BADAF4542C9ADF44BED5FA6CB3E_menu_98719A90225A4802A0625D3967E4DD47]",NavPublishStrip:"[id*=_Nav_PublishStrip]",StartMenuLeftOption:".scStartMenuLeftOption",Publish:{TheItemHasBeenPublished:"[id=LastPage]:not([style*='display:none'])",SettingsHidden:"[id=Settings][style*='display: none']",PublishingHidden:"[id=Publishing][style*='display: none']"},LoginBtn:{sc920:null,sc820:"input.btn"},scStartButton:{sc920:"[id=StartButton]",sc820:"[id=startButton]"}}},Storage:{SettingsSuffix:".Settings",ShowDebugData:!1,SnapShotSuffix:".WindowSnapShot.",WindowRoot:"Xyyz"},MaxIter:100,MaxNullOrUndefinedIter:100,prop:{AllTreeData:"AllTreeData"},Names:{SC:{TreeGlyphPrefix:"Tree_Glyph_",TreeNodePrefix:"Tree_Node_",TreeExpandedPng:{sc920:"treemenu_expanded.png",sc820:"todo"}},PopUp:"PopUp",StylesToInject:"StylesToInject",TreeMenuExpandedPng:"treemenu_expanded.png",TreeMenuCollapsedPng:"treemenu_collapsed.png",scDefaultAdminPassword:"b",scDefaultAdminUserName:"admin"}};class s{constructor(e){this.Xyyz=e}AtticMan(){return this.Xyyz.AtticMan}Const(){return this.Xyyz.Const}debug(){return this.Xyyz.debug}DesktopMan(){return this.Xyyz.OneDesktopMan}GuidMan(){return this.Xyyz.GuidMan}locMan(){return this.Xyyz.LocationMan}OneCEMan(){return this.Xyyz.OneCEMan}OneWinMan(){return this.Xyyz.OneWindowMan}PageDataMan(){return this.Xyyz.PageDataMan}MsgMan(){return this.Xyyz.MsgMan}Utilites(){return this.Xyyz.Utilities}MiscMan(){return this.Xyyz.MiscMan}PromiseGen(){return this.Xyyz.PromiseGeneric}PromiseOneStep(){return this.Xyyz.PromiseOneStep}ScUiMan(){return this.Xyyz.SitecoreUiMan}MsgFlag(){return this.Xyyz.MessageFlag}}!function(e){e[e.Unknown=0]="Unknown",e[e.LoginPage=1]="LoginPage",e[e.Desktop=2]="Desktop",e[e.ContentEditor=3]="ContentEditor",e[e.Launchpad=4]="Launchpad",e[e.Edit=5]="Edit",e[e.Normal=6]="Normal",e[e.Preview=7]="Preview"}(o||(o={}));class u extends s{constructor(e){super(e),e.debug.FuncStart(u.name),e.debug.FuncEnd(u.name)}Init(){}UpdateNickname(e){if(this.debug().FuncStart(this.UpdateNickname.name),e.idOfSelect){var t=this.GetFromStorageById(e.idOfSelect);t&&(t.NickName=e.NewNickname,this.WriteToStorage(t))}this.debug().FuncEnd(this.UpdateNickname)}ToggleFavorite(e){if(this.debug().FuncStart(this.ToggleFavorite.name),e.idOfSelect){var t=this.GetFromStorageById(e.idOfSelect);t&&(t.IsFavorite=!t.IsFavorite,this.WriteToStorage(t))}this.debug().FuncEnd(this.ToggleFavorite.name)}WriteToStorage(e){this.debug().FuncStart(this.WriteToStorage.name);var t=JSON.stringify(e);this.debug().Log("snapShotAsString: "+t),window.localStorage.setItem(this.Const().Storage.WindowRoot+this.Const().Storage.SnapShotSuffix+e.Id.asString,t),this.debug().FuncEnd(this.WriteToStorage.name)}GetFromStorageById(e){this.debug().FuncStart(this.GetFromStorageById.name,e.asString);var t=this.GetAllStorageAsIDataOneWindow(),n=null;if(t)for(var i=0;i<t.length;i++){var a=t[i];if(a.Id.asString===e.asString){n=a;break}}return n?this.debug().Log("found match",this.Utilites().TimeNicknameFavStr(n)):this.debug().Error(this.GetFromStorageById.name,"Match notfound"),this.debug().FuncEnd(this.GetFromStorageById.name),n}DebugSettings(e){this.debug().FuncStart(this.DebugSettings.name),this.debug().LogVal("Settings",JSON.stringify(e)),this.debug().FuncEnd(this.DebugSettings.name)}__getAllLocalStorageAsIOneStorageData(){this.debug().FuncStart(this.__getAllLocalStorageAsIOneStorageData.name);for(var e=[],t=0;t<window.localStorage.length;t++){var n={data:"",key:""};n.key=window.localStorage.key(t),n.key.startsWith(this.Const().Storage.WindowRoot+this.Const().Storage.SnapShotSuffix)&&(n.data=window.localStorage.getItem(n.key),e.push(n))}return this.debug().FuncEnd(this.__getAllLocalStorageAsIOneStorageData.name),e}GetAllStorageAsIDataOneWindow(){this.debug().FuncStart(this.GetAllStorageAsIDataOneWindow.name);var e=[],t=this.__getAllLocalStorageAsIOneStorageData();if(t)for(var n=0;n<t.length;n++){var i=t[n],a=JSON.parse(i.data);a&&(a.TimeStamp=new Date(a.TimeStamp),a.Id=this.Xyyz.GuidMan.ParseGuid(a.Id.asString),a.RawData=i,a.WindowType||(a.WindowType=o.Unknown,a.WindowFriendly=o[a.WindowType]),a.NickName||(a.NickName=""),e.push(a))}return e.sort((e,t)=>+t.TimeStamp-+e.TimeStamp),this.debug().FuncEnd(this.GetAllStorageAsIDataOneWindow.name),e}RemoveOneFromStorage(e){if(this.debug().FuncStart(this.RemoveOneFromStorage.name),e){var t=this.GetFromStorageById(e);if(t)!0===confirm("Remove ?: "+this.Xyyz.Utilities.TimeNicknameFavStr(t))&&window.localStorage.removeItem(t.RawData.key)}this.debug().FuncEnd(this.RemoveOneFromStorage.name)}GetRawFromStorageById(e){this.debug().FuncStart(this.GetRawFromStorageById.name,e.asString);var t=this.__getAllLocalStorageAsIOneStorageData();if(t)for(var n=0;n<t.length;n++)t[n];return this.debug().FuncEnd(this.GetRawFromStorageById.name),null}}class d{EmptyGuid(){return this.ParseGuid("00000000-0000-0000-0000-000000000000")}NewGuid(){var e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}));return this.ParseGuid(e)}ShortGuid(e){var t="{error}";return e&&e.asString.length>this.ShortGuidLength&&(t=e.asString.substr(0,this.ShortGuidLength)),t}ParseGuid(e){let t={asString:e,asShort:""};return t.asShort=this.ShortGuid(t),t}}var h=function(e,t,n,i){return new(n||(n=Promise))((function(a,o){function r(e){try{u(i.next(e))}catch(e){o(e)}}function s(e){try{u(i.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}u((i=i.apply(e,t||[])).next())}))};class c extends s{constructor(e){super(e),e.debug.FuncStart(c.name),e.debug.FuncEnd(c.name)}SetHref(e,t,n,i=this.Const().Iterations.MaxSetHrefEffort){this.debug().FuncStart(this.SetHref.name,e+" : "+i+" : has callback? "+(null!==t)),i-=1;var a=n.Window.location.href=e,o="complete"===n.DataDocSelf.Document.readyState;if(i>0)if(a&&o)this.debug().Log(this.SetHref.name,"triggering callback"),t();else{a||n.Window.location.href;var r=this;setTimeout((function(){this.debug().Log("setting timeout"),r.SetHref(e,t,n,i)}),r.Const().Timeouts.SetHrefEffortWait)}else this.debug().Log("changing href unsuccessful. Dying");this.debug().FuncEnd(this.SetHref.name)}ChangeLocationSwitchBoard(e,t,n=this.Const().Iterations.MaxIterationSwitchBoard){if(this.debug().FuncStart(this.ChangeLocationSwitchBoard.name,"desired = "+o[e]+" iteration: "+n+":"+this.Const().Iterations.MaxIterationSwitchBoard),n>0){n-=1;var i=this.PageDataMan().GetCurrentPageType();if(i===o.LoginPage){var a=this;this.AdminB(t.DataDocSelf,()=>{this.debug().Log("callback triggered"),a.ChangeLocationSwitchBoard(e,t,n)});a=this}else if(i===o.Launchpad||i===o.ContentEditor||i===o.Desktop){a=this;var r=function(){a.debug().Log("Callback triggered"),t=a.PageDataMan().SetWindowDataToCurrent(t.Window,t.DataDocSelf.Nickname),a.ChangeLocationSwitchBoard(e,t,n)};e===o.Desktop&&i!==o.Desktop?this.SetHref(this.Const().UrlSuffix.Desktop,r,t):e===o.ContentEditor&&i!==o.ContentEditor?this.SetHref(this.Const().UrlSuffix.CE,r,t):i===o.Desktop&&e===o.Desktop&&this.debug().Log("On Desktop")}}this.debug().FuncEnd(this.ChangeLocationSwitchBoard.name)}SetScMode(e,t){return new Promise(()=>h(this,void 0,void 0,(function*(){var n,i;this.debug().FuncStart(this.SetScMode.name,e.asString);var a=this.PageDataMan().GetCurrentPageType();if(a===o.ContentEditor||a===o.Desktop){for(var r=this.PageDataMan().TopLevelWindow().DataDocSelf,s=this.Xyyz.OneTreeMan.GetOneLiveTreeData(r),u=0;u<s.length;u++){var d=s[u];if(d.IsActive){n=d.NodeId;break}}yield alert(n.asString),n&&(i=yield this.PageDataMan().GetTargetWindowAsync(t,o.Edit))}else a!=o.Edit&&a!=o.Normal&&a!=o.Preview||i&&(window.opener.location.href=window.opener.location.href.replace("=normal",e.asString).replace("=preview",e.asString).replace("=edit",e.asString));this.debug().FuncEnd(this.SetScMode.name)})))}GetLoginButton(e){this.debug().FuncStart(this.GetLoginButton.name);var t=e.Document.getElementById(this.Const().ElemId.sc.scLoginBtn.sc920);return t||(t=e.Document.querySelector(this.Const().Selector.SC.LoginBtn.sc820)),this.debug().Log("toReturn: "+t),this.debug().FuncEnd(this.GetLoginButton.name),t}AdminB(e,t){this.debug().FuncStart(this.AdminB.name,"targetDoc: "+e.XyyzId.asShort),this.debug().Log("callback passed: "+(null!==t));var n=e.Document.getElementById(this.Const().ElemId.sc.scLoginUserName),i=e.Document.getElementById(this.Const().ElemId.sc.scLoginPassword);this.debug().Log("userNameElem: "+n),this.debug().Log("passwordElem: "+i),n.setAttribute("value",this.Const().Names.scDefaultAdminUserName),i.setAttribute("value",this.Const().Names.scDefaultAdminPassword);var a=this.GetLoginButton(e);a?(this.debug().Log("clicking"),a.click(),t?(this.debug().Log("Triggering callback"),setTimeout(t,this.Const().Timeouts.PostLoginBtnClick)):this.debug().Log("no callback passed")):this.debug().Error(this.AdminB.name,"No loginButton"),this.debug().FuncEnd(this.AdminB.name)}QkID(){return this.Const().ElemId}}class l extends s{constructor(e){super(e)}NotNullOrUndefined(e,t="",n=null){var i=!1;if(n||(n=this.Const().MaxNullOrUndefinedIter),(n-=1)>0)if(""===t&&(t=this.NotNullOrUndefined.name+" : no labelprovided"),"undefined"===e)this.debug().Error(t,"Is undefined");else if(e){if(this.debug().LogVal(t,"Passed"),i=!0,Array.isArray(e))for(var a=0;a<e.length;a++)i=i&&this.NotNullOrUndefined(e[a],a+1+":"+e.length+" "+t,n)}else this.debug().Error(t,"Is Null");else this.debug().Error(this.NotNullOrUndefined.name,"max iteration hit");return i}}class g extends s{constructor(e,t,n=null){super(e),n||(n=this.Const().IterHelper.MaxCount.Default),this.__maxIterations=n,this.__currentIteration=n,this.__timeout=e.Const.IterHelper.Timeouts.Default,this.__nickName=t,this.IsExhausted=!1}DecrementAndKeepGoing(){var e=!1;return!this.MsgMan().OperationCancelled&&this.__currentIteration>0?(this.__currentIteration-=1,this.__timeout+=this.__timeout*this.Const().IterHelper.GrowthPerIteration,this.__timeout>this.Const().IterHelper.Timeouts.Max&&(this.__timeout=this.Const().IterHelper.Timeouts.Max),this.debug().Log("DecrementAndKeepGoing: "+this.__nickName+" "+this.__currentIteration+":"+this.__maxIterations+" | timeout: "+this.__timeout),e=!0):(this.IsExhausted=!0,this.NotifyExhausted(),e=!1),e}NotifyExhausted(){this.debug().Log("Iteration: "+this.__nickName+" counter exhausted "+this.__currentIteration+":"+this.__maxIterations)}WaitAndThen(e){this.debug().FuncStart(this.WaitAndThen.name,this.__nickName+" "+e.name);setTimeout(e(),this.__timeout),this.debug().FuncEnd(this.WaitAndThen.name,this.__nickName)}Wait(){if(!this.MsgMan().OperationCancelled)return new Promise(e=>{setTimeout(e,this.__timeout)})}}var m=function(e,t,n,i){return new(n||(n=Promise))((function(a,o){function r(e){try{u(i.next(e))}catch(e){o(e)}}function s(e){try{u(i.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}u((i=i.apply(e,t||[])).next())}))};class f extends s{constructor(e){super(e)}WaitForNode(e,t,n,i,a){this.debug().FuncStart(this.WaitForNode.name,"looking for guid: iter: "+n+" "+e.asString+" on "+this.GuidMan().ShortGuid(t.XyyzId)),n--;var o=t.Document.getElementById(e.asString);if(o)this.debug().Log("foundOnPage. Triggering callback on complete"),this.__expandNode(o),a(o);else if(n>0){this.debug().Log("not found on page...setting timeout: "+i);var r=this;setTimeout((function(){n-=1,r.WaitForNode(e,t,n,i,a)}),i)}else this.debug().Log("Not Found. Triggering callback on complete"),a(null);this.debug().FuncEnd(this.WaitForNode.name)}__activateNode(e){this.debug().FuncStart(this.__activateNode.name),this.debug().Log("clicking it"),e.click(),this.debug().FuncEnd(this.__activateNode.name)}__expandNode(e){this.debug().FuncStart(this.__expandNode.name);var t=e.getAttribute("src");this.debug().Log("currentSrc"+t),t.indexOf(this.Const().Names.TreeMenuExpandedPng)<0&&(this.debug().Log("clicking it"),e.click()),this.debug().FuncEnd(this.__expandNode.name)}__collapseNode(e){var t=e.getAttribute("src");this.debug().Log("currentSrc"+t),t.indexOf(this.Const().Names.TreeMenuExpandedPng)>-1&&(this.debug().Log("clicking it"),e.click())}__collapseRootNode(e){var t=e.Document.getElementById(this.Const().ElemId.sc.SitecoreRootGlyphId);t?this.__collapseNode(t):this.debug().Error(this.__collapseRootNode.name,"Root glyph not found "+this.Const().ElemId.sc.SitecoreRootGlyphId)}WaitForAndRestoreOneNode(e,t){return m(this,void 0,void 0,(function*(){this.debug().FuncStart(this.WaitForAndRestoreOneNode.name,t.XyyzId.asShort);var n=this.Const().Names.SC.TreeGlyphPrefix+e.NodeId.asString;this.debug().Log("looking for: "+n+" "+e.NodeFriendly+" in "+t.XyyzId.asShort),this.debug().Log("document not null "+(null!=t.Document));for(var i=new g(this.Xyyz,this.WaitForAndRestoreOneNode.name),a=null;!a&&i.DecrementAndKeepGoing();)if(this.debug().Log("looking for: *"+n+"* "+e.NodeFriendly+" in *"+t.XyyzId.asShort+"*"),a=t.Document.getElementById(n)){if(e.IsExpanded&&this.__expandNode(a),e.IsActive){var o=this.Const().Names.SC.TreeNodePrefix+e.NodeId.asString,r=t.Document.getElementById(o);r&&this.__activateNode(r)}}else this.debug().Log("not Found...waiting: "),yield i.Wait();this.debug().FuncEnd(this.WaitForAndRestoreOneNode.name,t.XyyzId.asShort)}))}WaitForAndRestoreManyAllNodes(e,t,n=null){return m(this,void 0,void 0,(function*(){for(this.debug().FuncStart(this.WaitForAndRestoreManyAllNodes.name,t.XyyzId.asShort),n||(n=new g(this.Xyyz,this.WaitForAndRestoreManyAllNodes.name));e.AllTreeNodeAr.length>0&&n.DecrementAndKeepGoing();){var i=e.AllTreeNodeAr.shift();yield this.WaitForAndRestoreOneNode(i,t)}this.debug().FuncEnd(this.WaitForAndRestoreManyAllNodes.name)}))}RestoreCEStateAsync(e,t){return m(this,void 0,void 0,(function*(){this.debug().FuncStart(this.RestoreCEStateAsync.name,t.XyyzId.asShort);return this.debug().Log("Node Count in storage data: "+e.AllTreeNodeAr.length),yield this.WaitForAndRestoreManyAllNodes(e,t),this.debug().FuncEnd(this.RestoreCEStateAsync.name),!1}))}SaveStateOneContentEditor(e,t){this.debug().FuncStart("SaveOneContentEditor"),this.debug().Log("SaveOneContentEditor"),this.debug().Log("docElem is null: "+(null===t));var n=this.Xyyz.OneCEMan.MakeNewData(e);n.AllTreeNodeAr=this.Xyyz.OneTreeMan.GetOneLiveTreeData(t),this.Xyyz.OneWindowMan.PutCEDataToCurrentSnapShot(n),this.debug().FuncEnd("SaveOneContentEditor")}MakeNewData(e){this.debug().FuncStart("MakeNewData: "+e);var t={Id:e,AllTreeNodeAr:[]};return this.debug().FuncEnd("MakeNewData: "+e),t}}var S=function(e,t,n,i){return new(n||(n=Promise))((function(a,o){function r(e){try{u(i.next(e))}catch(e){o(e)}}function s(e){try{u(i.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}u((i=i.apply(e,t||[])).next())}))};class D extends s{constructor(e){e.debug.FuncStart(D.name),super(e),e.debug.FuncEnd(D.name)}__waitForAndClickRedStartButtonPromise(e){return new Promise((t,n)=>S(this,void 0,void 0,(function*(){this.debug().FuncStart(this.__waitForAndClickRedStartButtonPromise.name),this.MiscMan().NotNullOrUndefined([e,e.targetDoc],this.__waitForAndClickRedStartButtonPromise.name)?yield this.PromiseGen().RaceWaitAndClick(this.Const().Selector.SC.scStartButton,e.targetDoc).then(()=>t(e)).catch(e=>{this.debug().Error(this.__waitForAndClickRedStartButtonPromise.name,e),n()}):n(),this.debug().FuncEnd(this.__waitForAndClickRedStartButtonPromise.name)})))}__waitForIframeReady(e){return new Promise((t,n)=>S(this,void 0,void 0,(function*(){this.debug().FuncStart(this.__waitForIframeReady.name,"promiseBucket not null: "+(null!==e)),this.debug().PromiseBucketDebug(e,this.__waitForIframeReady.name),(yield this.PromiseGen().WaitForReadyIframe(e.NewIframe))?(this.debug().Log("resolved! : "),e.NewIframe.ContentDoc.Document=e.NewIframe.IframeElem.contentDocument,this.debug().DebugDataOneIframe(e.NewIframe),t(e)):(this.debug().Log("rejected ! : "),n(this.__waitForIframeReady.name)),this.debug().FuncEnd(this.__waitForIframeReady.name)})))}__waitForIframeCountDiffPromise(e){return new Promise((t,n)=>S(this,void 0,void 0,(function*(){this.debug().FuncStart(this.__waitForIframeCountDiffPromise.name),this.debug().MarkerA();var i=yield this.DesktopMan().WaitForIframeCountDiffWorker(e.IFramesbefore,e.targetWindow);this.debug().MarkerB(),i?(this.debug().MarkerC(),e.NewIframe=i,this.debug().DebugDataOneIframe(e.NewIframe),t(e)):n(this.__waitForIframeCountDiffPromise.name),this.debug().FuncEnd(this.__waitForIframeCountDiffPromise.name)})))}__waitForAndThenClickCEFromMenuPromise(e){return new Promise((t,n)=>S(this,void 0,void 0,(function*(){yield this.PromiseGen().WaitForThenClick(this.Const().Selector.SC.StartMenuLeftOption,e.targetWindow.DataDocSelf).then(()=>{t(e)}).catch(e=>{n(this.__waitForAndThenClickCEFromMenuPromise.name)})})))}__restoreDataToOneIframe(e){return new Promise((t,n)=>S(this,void 0,void 0,(function*(){this.debug().FuncStart(this.__restoreDataToOneIframe.name),this.debug().DebugDataOneIframe(e.NewIframe),(yield this.DesktopMan().RestoreDataToOneIframeWorker(e.oneCEdata,e.NewIframe))?t(e):n(this.__restoreDataToOneIframe.name),this.debug().FuncEnd(this.__restoreDataToOneIframe.name)})))}RunOneChain(e,t){return S(this,void 0,void 0,(function*(){if(this.debug().FuncStart(this.RunOneChain.name),this.MiscMan().NotNullOrUndefined([e,t],this.RunOneChain.name)){var n=this.DesktopMan().GetAllLiveIframeData(e),i={targetWindow:e,targetDoc:e.DataDocSelf,IFramesbefore:n,oneCEdata:t,NewIframe:null,LastChainLinkSuccessful:!1};yield this.__waitForAndClickRedStartButtonPromise(i).then(e=>this.__waitForAndThenClickCEFromMenuPromise(e)).then(e=>this.__waitForIframeCountDiffPromise(e)).then(e=>this.__waitForIframeReady(e)).then(e=>this.__restoreDataToOneIframe(e)).catch(e=>{this.debug().Error(this.RunOneChain.name,e)}),this.debug().FuncEnd(this.RunOneChain.name)}}))}}var b=function(e,t,n,i){return new(n||(n=Promise))((function(a,o){function r(e){try{u(i.next(e))}catch(e){o(e)}}function s(e){try{u(i.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}u((i=i.apply(e,t||[])).next())}))};class C extends s{constructor(e){e.debug.FuncStart(C.name),super(e),e.debug.FuncEnd(C.name)}RestoreDesktopStateAsync(e,t){return b(this,void 0,void 0,(function*(){if(this.debug().FuncStart(this.RestoreDesktopStateAsync.name),this.MiscMan().NotNullOrUndefined([e,t,t.AllCEAr],this.RestoreDesktopStateAsync.name))for(var n=0;n<t.AllCEAr.length;n++){this.debug().Log("data idx: "+n+":"+t.AllCEAr.length);var i=new D(this.Xyyz);yield i.RunOneChain(e,t.AllCEAr[n])}this.debug().FuncEnd(this.RestoreDesktopStateAsync.name)}))}RestoreDataToOneIframeWorker(e,t){return b(this,void 0,void 0,(function*(){this.debug().FuncStart(this.RestoreDataToOneIframeWorker.name,"data not null: "+(null!=e)+" newFrame not null: "+(null!==t));var n=!1;return this.debug().DebugDataOneIframe(t),e&&t?(yield this.Xyyz.OneCEMan.RestoreCEStateAsync(e,t.ContentDoc),n=!0):(this.debug().Error(this.RestoreDataToOneIframeWorker.name,"bad data"),n=!1),this.debug().FuncEnd(this.RestoreDataToOneIframeWorker.name,n.toString()),n}))}WaitForIframeCountDiffWorker(e,t){return b(this,void 0,void 0,(function*(){this.debug().FuncStart(this.WaitForIframeCountDiffWorker.name);for(var n=null,i=new g(this.Xyyz,this.WaitForIframeCountDiffWorker.name);!n&&i.DecrementAndKeepGoing();){let r=e.length;var a=this.GetAllLiveIframeData(t),o=a.length;if(this.debug().Log("iFrame count before: "+e.length),this.debug().Log("iFrame count after: "+a.length),o>r){n=a.filter(t=>!e.includes(t))[0]}else{yield i.Wait()}}return this.debug().FuncEnd(this.WaitForIframeCountDiffWorker.name),n}))}GetAllLiveIframeData(e){this.debug().FuncStart(this.GetAllLiveIframeData.name);var t=[],n=e.DataDocSelf.Document.querySelectorAll(this.Const().Selector.SC.IframeContent);if(n){this.debug().Log("iframeAr: "+n.length);for(var i=0;i<n.length;i++){this.debug().Log("pushing: "+i);var a=n[i],o=this.Utilites().DateOneIframeFactory(a,e.DataDocSelf,"desktop Iframe_"+i);o.ContentDoc.HasParentDesktop=!0,o.ContentDoc.IsCEDoc=!0,t.push(o)}}return this.debug().FuncEnd(this.GetAllLiveIframeData.name,"count:  "+t.length),t}SaveStateOneDesktop(e){this.debug().FuncStart(this.SaveStateOneDesktop.name),this.debug().Log("SaveOneDesktop");var t=this.GetAllLiveIframeData(e);if(t&&t.length>0)for(var n=0;n<t.length;n++){this.debug().Log("iframeIdx: "+n);var i=t[n];this.Xyyz.OneCEMan.SaveStateOneContentEditor(i.Id,i.ContentDoc)}this.debug().FuncEnd(this.SaveStateOneDesktop.name)}}class y extends s{constructor(e){super(e),e.debug.FuncStart(y.name),e.debug.FuncEnd(y.name)}GetFriendlyNameFromNode(e){this.debug().FuncStart(this.GetFriendlyNameFromNode.name);var t="unknown",n=e.parentNode.querySelector(this.Const().Selector.SC.IdStartsWithTreeNode);return n?t=n.innerText:this.debug().Log("No treeNode"),this.debug().FuncEnd(this.GetFriendlyNameFromNode.name,t),t}__isActive(e){var t=!1,n=e.querySelector(this.Const().Selector.SC.IdStartsWithTreeNode);n&&(n.className.indexOf(this.Const().ClassNames.SC.scContentTreeNodeActive)>-1&&(t=!0,this.debug().Log("** isActive "+e.innerText)));return t}__isExpanded(e){var t=!1;if(e)return e.getAttribute("src").indexOf(this.Const().Names.SC.TreeExpandedPng.sc920)>-1&&(t=!0),t}__isContentTreeNode(e){var t=!1;return e.className===this.Const().ClassNames.ContentTreeNode&&(t=!0),t}WalkNodeRecursive(e,t){var n=[];if(t-=1,e){var i=e.querySelector(this.Const().Selector.SC.ContentTreeNodeGlyph);if(this.__isContentTreeNode(e)){var a={IsExpanded:this.__isExpanded(i),IsActive:this.__isActive(e),NodeFriendly:"",NodeId:null};if(a.IsExpanded||a.IsActive){this.debug().LogVal("isExpanded",a.IsExpanded.toString()),this.debug().LogVal("isActive",a.IsActive.toString()),a.NodeFriendly=this.GetFriendlyNameFromNode(i),this.debug().LogVal("friendlyName",a.NodeFriendly);var o=i.id.replace(this.Const().Names.SC.TreeGlyphPrefix,"");a.NodeId=this.Xyyz.GuidMan.ParseGuid(o),n.push(a)}}var r=e.children;if(r&&r.length>0&&t>0)for(var s=0;s<r.length;s++){var u=r[s];n=n.concat(this.WalkNodeRecursive(u,t))}}return n}GetOneLiveTreeData(e){this.debug().FuncStart(this.GetOneLiveTreeData.name),this.debug().Log("targetDoc isnull: "+(null===e));var t=[];if(e){var n=e.Document.getElementById(this.Const().ElemId.sc.SitecoreRootNodeId);if(n){this.debug().Log("rootNode: "+n.innerHTML);var i=n.parentElement;t=this.WalkNodeRecursive(i,this.Const().MaxIter),this.debug().Log("foundNodes count: "+t.length)}else this.debug().Error(this.GetOneLiveTreeData.name,"no root node")}else this.debug().Error(this.GetOneLiveTreeData.name,"no targetDoc");return this.debug().FuncEnd(this.GetOneLiveTreeData.name),t}}var v=function(e,t,n,i){return new(n||(n=Promise))((function(a,o){function r(e){try{u(i.next(e))}catch(e){o(e)}}function s(e){try{u(i.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}u((i=i.apply(e,t||[])).next())}))};class w extends s{constructor(e){super(e)}__debugDataPublishChain(e,t){return this.debug().FuncStart(this.__debugDataPublishChain.name,t),this.debug().LogVal("docToPublish",this.debug().IsNullOrUndefined(e.docToPublish)),this.debug().LogVal("jqIframe",this.debug().IsNullOrUndefined(e.jqIframe)+" "+(e.jqIframe?e.jqIframe.IframeElem.src:"")),this.debug().LogVal("Iframe0blueIframe",this.debug().IsNullOrUndefined(e.Iframe0Blue)+" "+(e.Iframe0Blue?e.Iframe0Blue.IframeElem.src:"")),this.debug().LogVal("messageDialogIframeRed",this.debug().IsNullOrUndefined(e.messageDialogIframeRed)+" "+(e.messageDialogIframeRed?e.messageDialogIframeRed.IframeElem.src:"")),this.debug().FuncEnd(this.__debugDataPublishChain.name),e}PublishCE(e){return v(this,void 0,void 0,(function*(){this.debug().FuncStart(this.PublishCE.name);var t={docToPublish:e,TopLevelDoc:this.PageDataMan().TopLevelWindow().DataDocSelf,Iframe0Blue:null,jqIframe:null,messageDialogIframeRed:null};yield this.PromiseOneStep().ClickPublishOnNav(t).then(e=>this.PromiseOneStep().ClickMenuButtonPublishDropDown(e)).then(e=>this.__debugDataPublishChain(e,"post ClickMenuButtonPublishDropDown")).then(e=>this.PromiseOneStep().ClickMenuDropDownPublishItem(e)).then(e=>this.__debugDataPublishChain(e,"post MenuDropDownPublishItem")).then(e=>this.PromiseOneStep().GetThePublishItemDialog(e)).then(e=>this.__debugDataPublishChain(e,"post PublishItemDialog")).then(e=>this.GetDialogIframe0Blue(e)).then(e=>this.__WaitForAndClickPublishNextButton(e)).then(e=>this.GetMessageDialog(e)).then(e=>this.__waitForAndClickOk(e)).then(e=>this.__waitForAndClickClose(e)).catch(e=>{this.debug().Error(this.PublishCE.name,e)}),this.debug().FuncEnd(this.PublishCE.name)}))}__waitForAndClickClose(e){return v(this,void 0,void 0,(function*(){return yield this.PromiseGen().WaitForAndReturnFoundElem(e.Iframe0Blue.ContentDoc,this.Const().Selector.SC.Publish.SettingsHidden).then(()=>v(this,void 0,void 0,(function*(){yield this.PromiseGen().WaitForAndReturnFoundElem(e.Iframe0Blue.ContentDoc,this.Const().Selector.SC.Publish.TheItemHasBeenPublished,this.Const().IterHelper.MaxCount.OverridePublishing)}))).then(()=>v(this,void 0,void 0,(function*(){yield this.PromiseGen().WaitForThenClick(this.Const().Selector.SC.Cancel,e.Iframe0Blue.ContentDoc)}))),e}))}__waitForAndClickOk(e){return v(this,void 0,void 0,(function*(){return yield this.PromiseGen().WaitForThenClick(this.Const().Selector.SC.Ok,e.messageDialogIframeRed.ContentDoc),e}))}__WaitForAndClickPublishNextButton(e){return v(this,void 0,void 0,(function*(){return yield this.PromiseGen().WaitForThenClick(this.Const().Selector.SC.NextButton,e.Iframe0Blue.ContentDoc),e}))}GetMessageDialog(e){return v(this,void 0,void 0,(function*(){return e.messageDialogIframeRed=yield this.PromiseGen().WaitForAndReturnReadyIframe(e.jqIframe.ContentDoc,this.Const().Selector.SC.ContentIFrame1,"iframeRed"),e}))}GetDialogIframe0Blue(e=null){return v(this,void 0,void 0,(function*(){return this.debug().FuncStart(this.GetDialogIframe0Blue.name),e.Iframe0Blue=yield this.PromiseGen().WaitForAndReturnReadyIframe(e.jqIframe.ContentDoc,this.Const().Selector.SC.ContentIframe0,"Iframe0Blue"),this.debug().DebugDataOneIframe(e.Iframe0Blue),this.debug().FuncEnd(this.GetDialogIframe0Blue.name),e}))}__waitForThenFunc(e,t,n,i){return new Promise((a,o)=>v(this,void 0,void 0,(function*(){this.debug().FuncStart(this.__waitForThenFunc.name,e),this.debug().DebugIDataDoc(t);var r=null;(r=yield this.PromiseGen().WaitForAndReturnFoundElem(t,e))?(this.debug().Log("found"),i&&(this.debug().Log("executing func"),n=yield i(r,n)),this.__debugDataPublishChain(n,this.__waitForThenFunc.name),this.debug().FuncEnd(this.__waitForThenFunc.name,e),a(n)):o("not found")})))}}var p=function(e,t,n,i){return new(n||(n=Promise))((function(a,o){function r(e){try{u(i.next(e))}catch(e){o(e)}}function s(e){try{u(i.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}u((i=i.apply(e,t||[])).next())}))};class F extends s{constructor(e){super(e),e.debug.FuncStart(F.name),e.debug.FuncEnd(F.name)}SaveWindowState(e){this.debug().FuncStart(this.SaveWindowState.name);var t=this.PageDataMan().GetCurrentPageType();if(this.Xyyz.OneWindowMan.CreateNewWindowSnapShot(t),t===o.ContentEditor){this.debug().Log("is Content Editor");var n=this.Xyyz.GuidMan.EmptyGuid();this.Xyyz.OneCEMan.SaveStateOneContentEditor(n,e.DataDocSelf)}else t===o.Desktop?(this.debug().Log("is Desktop"),this.Xyyz.OneDesktopMan.SaveStateOneDesktop(e)):this.debug().Error(this.SaveWindowState.name,"Invalid page location "+t);this.debug().FuncEnd(this.SaveWindowState.name)}__getTopLevelIframe(e){var t=null,n=this.DesktopMan().GetAllLiveIframeData(e),i=-1;if(n&&n.length>0)for(var a=0;a<n.length;a++){var o=n[a];o&&o.Zindex>i&&(t=o,i=o.Zindex)}return t}PublishActiveCE(e){return p(this,void 0,void 0,(function*(){this.debug().FuncStart(this.PublishActiveCE.name);var t=null;if(this.PageDataMan().GetCurrentPageType()==o.Desktop){var n=this.__getTopLevelIframe(e);n&&(t=n.ContentDoc)}else t=this.PageDataMan().TopLevelWindow().DataDocSelf;if(this.debug().Log("docToPublish",this.debug().IsNullOrUndefined(t)),t){var i=new w(this.Xyyz);yield i.PublishCE(t)}this.debug().FuncEnd(this.PublishActiveCE.name)}))}RestoreWindowStateToTarget(e,t){return p(this,void 0,void 0,(function*(){this.debug().FuncStart(this.RestoreWindowStateToTarget.name),t&&(t.WindowType===o.ContentEditor?yield this.Xyyz.OneCEMan.RestoreCEStateAsync(t.AllCEAr[0],e.DataDocSelf):t.WindowType===o.Desktop?yield this.Xyyz.OneDesktopMan.RestoreDesktopStateAsync(e,t):this.debug().Error(this.RestoreWindowStateToTarget.name,"No match found for snap shot"),this.debug().FuncEnd(this.RestoreWindowStateToTarget.name))}))}PutCEDataToCurrentSnapShot(e){this.debug().FuncStart(this.PutCEDataToCurrentSnapShot.name),this.debug().Log("PutCEDataToCurrentSnapShot");var t=this.FindMatchingCeData(e);t?t=e:this.__activeWindowSnapShot.AllCEAr.push(e),this.UpdateStorage(),this.debug().FuncEnd(this.PutCEDataToCurrentSnapShot.name)}UpdateStorage(){this.debug().FuncStart(this.UpdateStorage.name),this.AtticMan().WriteToStorage(this.__activeWindowSnapShot),this.debug().FuncEnd(this.UpdateStorage.name)}FindMatchingCeData(e){for(var t=null,n=0;n<this.__activeWindowSnapShot.AllCEAr.length;n++){var i=this.__activeWindowSnapShot.AllCEAr[n];if(i.Id===e.Id){t=i;break}}return this.debug().Log("match found :"+(null!==t)),t}Init(){var e=this.PageDataMan().GetCurrentPageType();this.CreateNewWindowSnapShot(e)}CreateNewWindowSnapShot(e){this.debug().FuncStart("CreateNewWindowSnapShot");var t=new Date,n=this.Xyyz.GuidMan.NewGuid();this.__activeWindowSnapShot={TimeStamp:t,WindowType:e,WindowFriendly:e[e],AllCEAr:[],Id:n,IsFavorite:!1,NickName:"",RawData:null},this.debug().FuncEnd("CreateNewWindowSnapShot")}}var I=function(e,t,n,i){return new(n||(n=Promise))((function(a,o){function r(e){try{u(i.next(e))}catch(e){o(e)}}function s(e){try{u(i.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}u((i=i.apply(e,t||[])).next())}))};class _ extends s{constructor(e){super(e),this.debug().CtorName(this.constructor.name)}GetTargetWindowAsync(e,t){return I(this,void 0,void 0,(function*(){var n;if(this.debug().FuncStart(this.GetTargetWindowAsync.name),e)this.debug().Log("target window is self"),n=this.TopLevelWindow();else{this.debug().Log("target window is new");let e=this.__getUrlForWindowType(t);yield this.__getNewTargetWindowAsync(e).then(e=>n=e)}return this.debug().FuncEnd(this.GetTargetWindowAsync.name,"child window id: "+n.DataDocSelf.XyyzId.asShort),n}))}__getNewTargetWindowAsync(e){return I(this,void 0,void 0,(function*(){return new Promise(t=>{this.debug().FuncStart(this.__getNewTargetWindowAsync.name),this.debug().LogVal("newWindowUrl",e);var n=this.__winDataParent.Window.open(e),i=this;n.addEventListener("load",()=>{var e=i.SetWindowDataToCurrent(n,"newly spawned window");t(e)}),this.debug().FuncEnd(this.__getNewTargetWindowAsync.name)})}))}SetWindowDataToCurrent(e,t){var n={Friendly:"New Tab",Window:e,WindowType:o.Unknown,DataDocSelf:{ParentDoc:null,Document:e.document,HasParentDesktop:!1,XyyzId:this.GuidMan().NewGuid(),IsCEDoc:!1,ParentDesktop:null,Nickname:t}};return n.DataDocSelf.ParentDoc=n.DataDocSelf,n}TopLevelWindow(){return console.log("marker c"),this.__winDataParent}Init(){this.debug().FuncStart(this.Init.name),window.opener?(this.__winDataParent={Window:window.opener,Friendly:"Parent Window",WindowType:o.Unknown,DataDocSelf:{ParentDoc:null,Document:window.opener.document,HasParentDesktop:!1,XyyzId:this.GuidMan().NewGuid(),IsCEDoc:!1,ParentDesktop:null,Nickname:"Original Target Page"}},this.__winDataParent.DataDocSelf.ParentDoc=this.__winDataParent.DataDocSelf):this.debug().Error(this.constructor.name,"No Opener Page"),this.MsgMan().SetParentInfo(this.__winDataParent),this.debug().FuncEnd(this.Init.name)}GetPageTypeOfTargetWindow(e){var t;this.debug().FuncStart(this.GetPageTypeOfTargetWindow.name,e.location.href);var n=e.location.href;return n.indexOf(this.Const().UrlSuffix.Login)>-1?t=o.LoginPage:n.toLowerCase().indexOf(this.Const().UrlSuffix.Desktop.toLowerCase())>-1?(this.debug().Log("Testing for Desktop editor"),this.debug().Log("currentLoc.toLowerCase()"+n.toLowerCase()),this.debug().Log("this.Const().Url.Desktop.toLowerCase()"+this.Const().UrlSuffix.Desktop.toLowerCase()),t=o.Desktop):t=new RegExp(this.Const().Regex.ContentEditor).test(n)?o.ContentEditor:n.toLowerCase().indexOf(this.Const().UrlSuffix.LaunchPad.toLowerCase())>-1?o.Launchpad:o.Unknown,this.debug().FuncEnd(this.GetPageTypeOfTargetWindow.name,o[t]),t}__getUrlForWindowType(e){var t;this.debug().NotNullCheck("this.__winDataParent.DataDocSelf.Document",this.__winDataParent.DataDocSelf.Document);var n=this.__winDataParent.DataDocSelf.Document.location.origin;switch(e){case o.ContentEditor:t=n+this.Const().UrlSuffix.CE;break;case o.Desktop:t=n+this.Const().UrlSuffix.Desktop;break;case o.Edit:case o.Preview:case o.Normal:t=n+this.Const().UrlSuffix.None;break;default:t=n,this.debug().Error(this.__getUrlForWindowType.name,"unaccounted for window type")}return t}GetCurrentPageType(){this.debug().FuncStart(this.GetCurrentPageType.name);var e=o.Unknown;return this.__winDataParent&&this.__winDataParent&&this.__winDataParent.Window&&this.__winDataParent.DataDocSelf&&(e=this.GetPageTypeOfTargetWindow(this.__winDataParent.Window)),this.debug().FuncEnd(this.GetCurrentPageType.name+" ("+e+") "+o[e]),e}DebugInfo(){this.debug().FuncStart(this.DebugInfo.name),this.debug().Log(this.__winDataParent.Window),this.debug().Log(this.__winDataParent.DataDocSelf),this.debug().FuncEnd(this.DebugInfo.name)}}var k=function(e,t,n,i){return new(n||(n=Promise))((function(a,o){function r(e){try{u(i.next(e))}catch(e){o(e)}}function s(e){try{u(i.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}u((i=i.apply(e,t||[])).next())}))};class P extends s{constructor(e){e.debug.FuncStart(P.name),super(e),e.debug.FuncEnd(P.name)}WaitForReadyIframe(e){return k(this,void 0,void 0,(function*(){return new Promise(t=>k(this,void 0,void 0,(function*(){this.debug().FuncStart(this.WaitForReadyIframe.name,e.Nickname+" "+e.Id.asShort),this.debug().DebugDataOneIframe(e);var n=new g(this.Xyyz,this.WaitForReadyIframe.name),i=!1;for(this.debug().MarkerA();n.DecrementAndKeepGoing()&&!i;){this.debug().MarkerB();var a=e.IframeElem.contentDocument.readyState.toString(),o="complete"===a;this.debug().Log("currentReadyState : "+a),this.debug().MarkerC(),this.debug().Log("isReadyStateComplete: "+o),o?(this.debug().Log("toReturn A is true"),i=!0,e.ContentDoc=this.Utilites().DataOneContentDocFactoryFromIframe(e.IframeElem,e.ContentDoc.ParentDoc,e.Nickname)):yield n.Wait()}this.debug().DebugDataOneIframe(e),this.debug().FuncEnd(this.WaitForReadyIframe.name,e.Nickname+" : "+a+" is ready: "+i.toString()),t(e)})))}))}WaitForAndReturnReadyIframe(e,t,n){return k(this,void 0,void 0,(function*(){return new Promise(i=>k(this,void 0,void 0,(function*(){var a;yield this.WaitForAndReturnFoundElem(e,t).then(t=>k(this,void 0,void 0,(function*(){if(t)return a=this.Utilites().DateOneIframeFactory(t,e,n),this.debug().DebugDataOneIframe(a),a}))).then(e=>k(this,void 0,void 0,(function*(){e=yield this.PromiseGen().WaitForReadyIframe(e),i(e)})))})))}))}WaitForAndReturnFoundElem(e,t,n=8){return k(this,void 0,void 0,(function*(){return new Promise((i,a)=>k(this,void 0,void 0,(function*(){this.debug().FuncStart(this.WaitForAndReturnFoundElem.name,"selector: "+t+" nickname: "+e.Nickname);for(var o=null,r=new g(this.Xyyz,this.WaitForAndReturnFoundElem.name,n);!o&&r.DecrementAndKeepGoing();)this.debug().LogVal("targetDoc.Document",e.Document.toString()),this.debug().LogVal("targetDoc.Document.location",e.Document.location.toString()),this.debug().LogVal("targetDoc.Document.location.href",e.Document.location.href),(o=e.Document.querySelector(t))?(this.debug().Log("found"),this.debug().LogVal("found.style.display",o.style.display),this.debug().FuncEnd(this.WaitForAndReturnFoundElem.name,t+e.Document.location.href),i(o)):yield r.Wait();!o&&r.IsExhausted&&(this.debug().FuncEnd(this.WaitForAndReturnFoundElem.name,t+e.Document.location.href),a("exhausted"))})))}))}WaitForPageReadyNative(e){return k(this,void 0,void 0,(function*(){return new Promise((t,n)=>k(this,void 0,void 0,(function*(){this.debug().FuncStart(this.WaitForPageReadyNative.name);new g(this.Xyyz,this.WaitForThenClick.name,5);this.MiscMan().NotNullOrUndefined(e,this.WaitForPageReadyNative.name+" document")})))}))}WaitForAndClickWithPayload(e,t,n){return new Promise((i,a)=>k(this,void 0,void 0,(function*(){this.debug().FuncStart(this.WaitForAndClickWithPayload.name,e),yield this.PromiseGen().WaitForThenClick(e,t).then(()=>i(n)).catch(e=>{this.debug().Error(this.WaitForAndClickWithPayload.name,e),a(e)})})))}WaitForPageReady(e){return k(this,void 0,void 0,(function*(){return new Promise((t,n)=>k(this,void 0,void 0,(function*(){this.debug().FuncStart(this.WaitForPageReady.name),this.debug().NotNullCheck("toReturn",e),this.debug().NotNullCheck("toReturn",e.DataDocSelf),this.debug().NotNullCheck("toReturn",e.DataDocSelf.Document),this.debug().NotNullCheck("toReturn",e.DataDocSelf.Document.location),this.debug().NotNullCheck("toReturn",e.DataDocSelf.Document.location.href),this.debug().LogVal("targetWindow.DataDocSelf.Document.location.href",e.DataDocSelf.Document.location.href),e&&(yield this.WaitForPageReadyNative(e).then(()=>t()).catch(e=>{n(e)})),this.debug().FuncEnd(this.WaitForPageReady.name)})))}))}RaceWaitAndClick(e,t,n=null){return k(this,void 0,void 0,(function*(){this.debug().FuncStart(this.RaceWaitAndClick.name);var i=this.WaitForThenClick(e.sc920,t,n),a=this.WaitForThenClick(e.sc820,t,n);return this.debug().FuncEnd(this.RaceWaitAndClick.name),yield Promise.race([i,a])}))}WaitForThenClick(e,t,n=null){return new Promise((i,a)=>k(this,void 0,void 0,(function*(){if(t){this.debug().FuncStart(this.WaitForThenClick.name,e);for(var o=null,r=new g(this.Xyyz,this.WaitForThenClick.name);!o&&r.DecrementAndKeepGoing()&&!this.MsgMan().OperationCancelled;)(o=t.Document.querySelector(e))?(this.debug().Log("found and clicking"),o.click(),this.debug().FuncEnd(this.WaitForThenClick.name,e),n&&n(),i()):yield r.Wait()}else a();this.debug().FuncEnd(this.WaitForThenClick.name,e),!o&&r.IsExhausted&&a("exhausted")})))}}var E=function(e,t,n,i){return new(n||(n=Promise))((function(a,o){function r(e){try{u(i.next(e))}catch(e){o(e)}}function s(e){try{u(i.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}u((i=i.apply(e,t||[])).next())}))};class N extends s{constructor(e){e.debug.FuncStart(P.name),super(e),e.debug.FuncEnd(P.name)}ClickPublishOnNav(e){return E(this,void 0,void 0,(function*(){return yield this.PromiseGen().WaitForThenClick(this.Const().Selector.SC.NavPublishStrip,e.docToPublish),e}))}ClickMenuButtonPublishDropDown(e=null){return E(this,void 0,void 0,(function*(){return yield this.PromiseGen().WaitForThenClick(this.Const().Selector.SC.MenuButtonPublish,e.docToPublish),e}))}ClickMenuDropDownPublishItem(e=null){return E(this,void 0,void 0,(function*(){return yield this.PromiseGen().WaitForAndClickWithPayload(this.Const().Selector.SC.MenuDropDownPublishItem,e.docToPublish,e)}))}GetThePublishItemDialog(e=null){return E(this,void 0,void 0,(function*(){return yield this.PromiseGen().WaitForAndReturnFoundElem(e.TopLevelDoc,this.Const().Selector.SC.JqueryModalDialogsFrame).then(t=>(e.jqIframe=this.Utilites().DateOneIframeFactory(t,e.docToPublish.ParentDoc,"jqIframe"),e)).then(t=>E(this,void 0,void 0,(function*(){yield this.PromiseGen().WaitForReadyIframe(t.jqIframe),e=t}))),e}))}}class T{constructor(e){e.FuncStart(T.name),this.GuidMan=new d,this.Utilities=new T(e),e.FuncEnd(T.name)}SelectHeaderStr(){let e="";return e+=this.Buffer("...Time Stamp",23,".",!1),e+=this.Buffer("- Page Type",20,".",!1,!1),e+=this.Buffer("- Nickname",16,".",!1,!1),e+=this.Buffer("- Fav.",4,".",!1),e}MakeSelectorFromId(e){return"[id="+e+"]"}DateOneIframeFactory(e,t,n){return{Index:-1,IframeElem:e,Id:this.GuidMan.NewGuid(),Zindex:e.style.zIndex?parseInt(e.style.zIndex):-1,Nickname:n,ContentDoc:this.DataOneContentDocFactoryFromIframe(e,t,n)}}DataOneContentDocFactoryFromIframe(e,t,n){return{ParentDoc:t,Document:e.contentDocument,HasParentDesktop:!1,XyyzId:this.GuidMan.NewGuid(),IsCEDoc:!1,ParentDesktop:null,Nickname:n+" - content doc"}}TimeNicknameFavStr(e){var t=e.WindowType===o.Unknown?"?":o[e.WindowType];return this.MakeFriendlyDate(e.TimeStamp)+" - "+this.Buffer(t,17," ",!1)+" - "+this.Buffer(e.NickName,16," ",!1)+" - "+this.Buffer(e.IsFavorite?"*":" ",1)}Buffer(e,t,n=" ",i=!0,a=!0){var o=e;if(0===n.length&&(n=" "),o.length>t&&(o=t>6?o.substring(0,t-3)+"...":o.substring(0,t)),o.length<t){var r=t-o.length;" "===n&&a&&(n="&nbsp;");for(var s=0;s<r;s++)i?o=n+o:o+=n}return o}MakeFriendlyDate(e){var t=e.getFullYear(),n=e.getMonth(),i=this.Utilities.Buffer(e.getDay().toString(),2,"0"),a=this.Utilities.Buffer(e.getMinutes().toString(),2,"0"),o=e.getHours(),r=o>=12?"pm":"am",s=(o%=12)||12;return t+"."+n+"."+i+" "+this.Utilities.Buffer(s.toString(),2,"0")+":"+a+" "+r}}var W;n(0);!function(e){e[e.AddCETab=0]="AddCETab",e[e.AdminB=1]="AdminB",e[e.GoDesktop=2]="GoDesktop",e[e.OpenCE=3]="OpenCE",e[e.QuickPublish=4]="QuickPublish",e[e.RemoveFromStorage=5]="RemoveFromStorage",e[e.TakeSnapShot=6]="TakeSnapShot",e[e.UpdateNickName=7]="UpdateNickName",e[e.RestoreClick=8]="RestoreClick",e[e.Unknown=9]="Unknown",e[e.GetAllStorageOneWindow=10]="GetAllStorageOneWindow",e[e.TaskSuccessful=11]="TaskSuccessful",e[e.SetScMode=12]="SetScMode",e[e.TaskFailed=13]="TaskFailed",e[e.GiveCurrentData=14]="GiveCurrentData"}(W||(W={}));class A{constructor(e){this.MsgFlag=e}}var M=function(e,t,n,i){return new(n||(n=Promise))((function(a,o){function r(e){try{u(i.next(e))}catch(e){o(e)}}function s(e){try{u(i.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}u((i=i.apply(e,t||[])).next())}))},L=L||{};class O extends s{constructor(e){super(e),e.debug.FuncStart(O.name),e.debug.FuncEnd(O.name)}Init(){L.runtime.onMessage.addListener(e=>{this.ReceiveMessage(e)})}NotifyCompleteOnContent(e=null,t){e||(e=this.PageDataMan().TopLevelWindow());let n=e.DataDocSelf.Document.getElementsByTagName("body")[0];var i=e.DataDocSelf.Document.createElement("div");i.innerHTML="<div>"+t+"</div>",i.style.position="absolute",i.style.top="100px",i.style.left="100px",i.style.backgroundColor="yellow",i.style.zIndex="999",i.style.fontSize="40px",setTimeout((function(){i.remove(),window.close()}),this.Const().Timeouts.WaitBeforeRemovingCompleteFlagOnContent),n.appendChild(i)}ReceiveMessage(e){return M(this,void 0,void 0,(function*(){switch(e.MsgFlag){case W.AddCETab:yield this.PromiseGen().RaceWaitAndClick(this.Const().Selector.SC.scStartButton,this.PageDataMan().TopLevelWindow().DataDocSelf).then(()=>{this.PromiseGen().WaitForThenClick(this.Const().Selector.SC.StartMenuLeftOption,this.PageDataMan().TopLevelWindow().DataDocSelf)});break;case W.AdminB:this.locMan().AdminB(this.PageDataMan().TopLevelWindow().DataDocSelf,null);break;case W.GetAllStorageOneWindow:this.AtticMan().GetAllStorageAsIDataOneWindow();break;case W.GiveCurrentData:this.AtticMan().GetAllStorageAsIDataOneWindow();break;case W.GoDesktop:this.locMan().ChangeLocationSwitchBoard(o.Desktop,this.PageDataMan().TopLevelWindow());break;case W.OpenCE:this.locMan().ChangeLocationSwitchBoard(o.ContentEditor,this.PageDataMan().TopLevelWindow());break;case W.QuickPublish:var t=this.PageDataMan().TopLevelWindow();yield this.OneWinMan().PublishActiveCE(t);break;case W.SetScMode:this.locMan().SetScMode(e.Data.ReqScMode,e.Data.UseOriginalWindowLocation).then(()=>this.respondSuccessful()).catch(()=>this.respondFail());break;case W.RestoreClick:yield this.__restoreClick(e.Data).then(()=>this.respondSuccessful()).catch(()=>this.respondFail());break;case W.TaskSuccessful:this.NotifyCompleteOnContent(null,e.Data.ScreenMessage);case W.TakeSnapShot:this.Xyyz.OneWindowMan.SaveWindowState(this.PageDataMan().TopLevelWindow())}}))}respondSuccessful(){this.MsgMan().SendMessage(new A(W.TaskSuccessful))}respondFail(){this.MsgMan().SendMessage(new A(W.TaskFailed))}SendMessage(e){}__restoreClick(e){return new Promise(()=>M(this,void 0,void 0,(function*(){try{this.debug().MarkerA();var t=this.AtticMan().GetFromStorageById(e.idOfSelect);this.debug().MarkerB();var n=yield this.PageDataMan().GetTargetWindowAsync(!!e.UseOriginalWindowLocation,t.WindowType);n?yield this.Xyyz.OneWindowMan.RestoreWindowStateToTarget(n,t).then(()=>this.respondSuccessful()).catch(()=>this.respondFail()):this.debug().Error(this.__restoreClick.name,"no target window")}catch(e){this.debug().Error(this.__restoreClick.name,e)}})))}IsDebugEnabled(){throw new Error("Method not implemented.")}SetParentInfo(e){}}class x{constructor(e,t){t.FuncStart(x.name),this.debug=t,this.SitecoreUiMan=e,this.Init(),t.FuncEnd(x.name)}Init(){this.debug.FuncStart(this.Init.name),this.AtticMan=new u(this),this.GuidMan=new d,this.LocationMan=new c(this),this.MsgMan=new O(this),this.MiscMan=new l(this),this.OneCEMan=new f(this),this.OneDesktopMan=new C(this),this.OneTreeMan=new y(this),this.OneWindowMan=new F(this),this.PageDataMan=new _(this),this.PromiseGeneric=new P(this),this.PromiseOneStep=new N(this),this.Utilities=new T(this.debug),this.init(),this.debug.FuncEnd(this.Init.name)}init(){this.debug.FuncStart(x.constructor.name+" "+this.init.name),this.Const=r.ContConst,this.AtticMan.Init(),this.debug.Enabled=this.MsgMan.IsDebugEnabled(),this.PageDataMan.Init(),this.OneWindowMan.Init(),this.MsgMan.Init(),this.debug.FuncEnd(x.constructor.name+" "+this.init.name)}}var R=R||{};let G=new class{constructor(e){this.Enabled=!1,this.__debugTextChangedCallbacks=[],this.debugPrefix="\t\t",this.__indentCount=0,this.ParentWindow=e}DebugIDataDoc(e){this.FuncStart(this.DebugIDataDoc.name),this.Log(""),this.Log(this.debugPrefix+this.DebugIDataDoc.name),e?(this.Log(this.debugPrefix+"dataOneDoc: \t"+this.IsNullOrUndefined(e)),this.Log(this.debugPrefix+"dataOneDoc.XyyzId.asShort: \t"+this.IsNullOrUndefined(e.XyyzId.asShort)),this.Log(this.debugPrefix+"dataOneDoc.Document: \t"+this.IsNullOrUndefined(e.Document)),e.Document?(this.LogVal(this.debugPrefix+"dataOneDoc.Document.readyState:",e.Document.readyState),e.Document.location?this.LogVal(this.debugPrefix+"targetDoc.location.href",e.Document.location.href):this.Log(this.debugPrefix+"dataOneDoc.Document.location - does not exist")):this.Log(this.debugPrefix+"dataOneDoc.Document - does not exist")):this.Error(this.DebugIDataDoc.name,"no targetDoc"),this.Log("")}AddDebugTextChangedCallback(e,t){this.__debugTextChangedCallbacks.push({Caller:e,Func:t})}HndlrClearDebugText(e,t=!1){var n=!0;if(t&&(n=confirm("Clear Debug TextArea ?")),console.log("maker pink"),n){e.__triggerAllDebugTextChangedCallbacks({NewText:"--- Debug Text Reset ---",Append:!1})}}MarkerA(){this.__markerRaw("A")}MarkerB(){this.__markerRaw("B")}MarkerC(){this.__markerRaw("C")}MarkerD(){this.__markerRaw("D")}MarkerE(){this.__markerRaw("E")}__markerRaw(e){this.Log("Marker "+e)}LogVal(e,t){this.Log(e+" : "+t)}Log(e,t="",n=!1){if(this.Enabled){for(var i=0;i<this.__indentCount;i++)e="  "+e;if(!n)for(i=0;i<3;i++)e=" "+e;this.__triggerAllDebugTextChangedCallbacks({NewText:e,Append:!0}),console.log(e),this.ParentWindow&&this.ParentWindow.console.log(e)}}__triggerAllDebugTextChangedCallbacks(e){for(var t=0;t<this.__debugTextChangedCallbacks.length;t++){var n=this.__debugTextChangedCallbacks[t];n.Func(n.Caller,e)}}CtorName(e){this.Log("Constructor: "+e)}FuncStart(e,t){e="s) "+e,(t=t?t.toString():"").length>0&&(e=e+" : "+t),this.Log(e,"",!0),this.__indentCount++,this.__indentCount>10&&(this.__indentCount=10)}FuncEnd(e,t=""){e="e) "+e,t.length>0&&(e=e+" : "+t),this.__indentCount--,this.__indentCount<0&&(this.__indentCount=0),this.Log(e,t,!0)}Error(e,t){e||(e="unknown"),t||(t="unknown"),this.Log(""),this.Log("\t\t** ERROR ** "+e),this.Log(""),this.Log("\t\t  "+t),this.Log(""),this.Log("\t\t** ERROR ** "+e),this.Log("")}NotNullCheck(e,t){void 0===t?this.LogVal(e,"Is Undefined"):t?this.LogVal(e,"Is Not Null"):this.LogVal(e,"Is Null")}IsNullOrUndefined(e){return e?void 0===e?"Is Undefined":"Not Null":"Is Null"}PromiseBucketDebug(e,t){this.FuncStart(this.PromiseBucketDebug.name,t),this.Log("promiseBucket : "+this.IsNullOrUndefined(e)),e&&void 0!==e&&(this.Log("promiseBucket.IFramesbefore: "+this.IsNullOrUndefined(e.IFramesbefore)),this.Log("promiseBucket.targetWindow: "+this.IsNullOrUndefined(e.targetWindow)),this.Log("promiseBucket.oneCEdata: "+this.IsNullOrUndefined(e.oneCEdata)),this.Log("promiseBucket.NewIframe: "+this.IsNullOrUndefined(e.NewIframe)),e.NewIframe&&this.DebugDataOneIframe(e.NewIframe)),this.FuncEnd(this.PromiseBucketDebug.name,t)}DebugDataOneIframe(e){this.FuncStart(this.DebugDataOneIframe.name),this.Log("dataOneIframe : "+this.IsNullOrUndefined(e)),e&&(this.Log("dataOneIframe.Nickname : "+e.Nickname),this.Log("dataOneIframe.IframeElem: \t"+this.IsNullOrUndefined(e.IframeElem)),e.IframeElem&&this.Log("dataOneIframe.id: \t"+this.IsNullOrUndefined(e.IframeElem.id)),this.Log("dataOneIframe.ContentDoc: \t"+this.IsNullOrUndefined(e.ContentDoc)),this.DebugIDataDoc(e.ContentDoc)),this.FuncEnd(this.DebugDataOneIframe.name)}}(window.opener),B=new i(G);R.HubObj=new x(B,G)}]);