console.log('_first loaded'),console.log('_SpokeBase loaded');var SpokeBase=function(xyyz){this.Xyyz=xyyz};exports=SpokeBase;var PageType,__extends=this&&this.__extends||function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}(),ClassOneLivingIframe=function(_super){function ClassOneLivingIframe(iframeIndex,iframeElem,xyyz){var _this=_super.call(this,xyyz)||this;return xyyz.debug.FuncStart(ClassOneLivingIframe.name+' : '+iframeIndex),_this.Index=iframeIndex,_this.IframeElem=iframeElem,_this.DocElem=iframeElem.contentDocument,xyyz.debug.Log('e) OneLivingIframeData'),_this}return __extends(ClassOneLivingIframe,_super),ClassOneLivingIframe}(SpokeBase),Debug=function(){function Debug(parentWindow){console.log('debug'),this.__indentCount=0,this.ParentWindow=parentWindow}return Debug.prototype.__getTextArea=function(){return document.getElementById('ta-debug')},Debug.prototype.ClearTextArea=function(){var ta=this.__getTextArea();ta?ta.value='':this.Error(Debug.name,'No text area found')},Debug.prototype.Log=function(text){for(var idx=0;idx<this.__indentCount;idx++)text='  '+text;console.log(text);var ta=this.__getTextArea();ta&&(ta.value+=text+'\\n\\r',ta.scrollTop=ta.scrollHeight),this.ParentWindow&&this.ParentWindow.console.log(text)},Debug.prototype.FuncStart=function(text){text='s) '+text,this.Log(text),this.__indentCount++},Debug.prototype.FuncEnd=function(text){text='e) '+text,this.__indentCount--,this.Log(text)},Debug.prototype.Error=function(container,text){container||(container='unknown'),text||(text='unknown');var logText='** ERROR ** '+container+':'+text;this.Log(logText)},Debug}(),FeedbackManager=(__extends=this&&this.__extends||function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}(),function(_super){function FeedbackManager(xyyz){var _this=_super.call(this,xyyz)||this;return console.log('Feedback'),_this}return __extends(FeedbackManager,_super),FeedbackManager.prototype.__getTextArea=function(){return document.getElementById(this.Xyyz.InjectConst.ElemId.textAreaFeedback)},FeedbackManager.prototype.ClearTextArea=function(){var ta=this.__getTextArea();ta?ta.value='':this.Xyyz.debug.Error(FeedbackManager.name,'No text area found')},FeedbackManager.prototype.WriteLine=function(text){var ta=this.__getTextArea();ta&&(ta.value+=text+'\\n\\r')},FeedbackManager}(SpokeBase)),Hub=function(){function Hub(){this.debug=new Debug(window.opener),this.debug.FuncStart(Hub.name),this.Start(),this.debug.FuncEnd(Hub.name)}return Hub.prototype.Start=function(){this.debug.FuncStart(this.Start.name),console.log('marker A'),this.PageData=new PageData(window,this),console.log('marker B'),this.EventMan=new EventManager(this),console.log('marker C'),this.Utilities=new Utilities(this),console.log('marker D'),this.InjectConst=new InjectConst(this),console.log('marker E'),this.LocationMan=new LocationManager(this),console.log('marker F'),this.ManyTreesMan=new ManyTrees(this),console.log('marker G'),this.OneTreeMan=new OneTreeManager(this),console.log('marker H'),this.WindowTreeSnapShotMan=new WindowSnapShotManager(this),console.log('marker I'),this.SnapShotOneContentEditorMan=new SnapShotOneContentEditorManager(this),console.log('marker J'),this.FeedbackMan=new FeedbackManager(this),this.init(),this.debug.FuncEnd(this.Start.name)},Hub.prototype.init=function(){this.debug.FuncStart(Hub.constructor.name+' '+this.init.name),this.EventMan.WireMenuButtons(),this.debug.FuncEnd(Hub.constructor.name+' '+this.init.name)},Hub}(),LocationManager=(__extends=this&&this.__extends||function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}(),function(_super){function LocationManager(xyyz){var _this=_super.call(this,xyyz)||this;return xyyz.debug.FuncStart(LocationManager.name),_this.MaxAttempts=10,_this.CurrentAttempt=_this.MaxAttempts,_this.EffortWait=1e3,xyyz.debug.FuncEnd(LocationManager.name),_this}return __extends(LocationManager,_super),LocationManager.prototype.SetHref=function(href,callback,isFromTimeout,effortCount){this.Xyyz.debug.FuncStart(this.SetHref.toString()+' : '+href+' : '+isFromTimeout+' : '+effortCount),this.Xyyz.PageData.WinData.Opener.Window.location.href=href,isFromTimeout?effortCount--:effortCount=this.MaxAttempts,this.Xyyz.PageData.WinData.Opener.Window.location.href===href?callback():effortCount>0?setTimeout((function(){this.SetHref(href,callback,!0,effortCount)}),this.EffortWait):this.Xyyz.debug.Log('changing href unsuccessful. Dying'),this.Xyyz.debug.FuncEnd(this.SetHref.name)},LocationManager.prototype.ChangeLocation=function(desiredPageType){this.Xyyz.debug.FuncStart(this.ChangeLocation.name);var currentState=this.Xyyz.PageData.CurrentOpenerPageState();if(currentState===PageType.LoginPage){this.Xyyz.debug.Log('On Login page: '),this.AdminB();var self=this;setTimeout((function(){self.Xyyz.LocationMan.ChangeLocation(desiredPageType)}),1e3)}else currentState===PageType.Launchpad?desiredPageType===PageType.Desktop?this.SetHref(this.Xyyz.InjectConst.Url.Desktop,(function(){this.ChangeLocation(desiredPageType)}),null,null):desiredPageType===PageType.ContentEditor&&this.SetHref(this.Xyyz.InjectConst.Url.ContentEditor,(function(){this.ChangeLocation(desiredPageType)}),null,null):currentState===PageType.Desktop&&(this.Xyyz.debug.Log('On Desktop'),this.Xyyz.LocationMan.TriggerRedButton());this.Xyyz.debug.FuncEnd(this.Xyyz.LocationMan.ChangeLocation.name)},LocationManager.prototype.RedButton=function(iteration){this.Xyyz.debug.FuncStart(this.Xyyz.LocationMan.RedButton.name+':'+iteration);var found=this.Xyyz.PageData.WinData.Opener.Document.getElementById('StartButton');if(this.Xyyz.debug.Log('Red Button: '+found+'  '+this.Xyyz.PageData.WinData.Opener.Window.location.href+' '+iteration),found){found.click();var menuLeft=this.Xyyz.PageData.WinData.Opener.Document.querySelector('.scStartMenuLeftOption');menuLeft&&menuLeft.click()}else if((iteration-=1)>0){var self=this;setTimeout((function(){self.Xyyz.LocationMan.RedButton(iteration)}),1500)}this.Xyyz.debug.FuncEnd(this.Xyyz.LocationMan.RedButton.name)},LocationManager.prototype.TriggerRedButton=function(){this.Xyyz.debug.FuncStart(this.Xyyz.LocationMan.TriggerRedButton.name);var self=this;setTimeout((function(){self.Xyyz.LocationMan.RedButton(10)}),1500),this.Xyyz.debug.FuncEnd(this.Xyyz.LocationMan.TriggerRedButton.name)},LocationManager.prototype.SetScMode=function(newValue){var newValueB='='+newValue;window.opener.location.href=window.opener.location.href.replace('=normal',newValueB).replace('=preview',newValueB).replace('=edit',newValueB)},LocationManager.prototype.AdminB=function(){this.Xyyz.debug.FuncStart(this.AdminB.name);var userNameElem=this.Xyyz.PageData.WinData.Opener.Document.getElementById('UserName'),passwordElem=this.Xyyz.PageData.WinData.Opener.Document.getElementById('Password');this.Xyyz.debug.Log('userNameElem: '+userNameElem),this.Xyyz.debug.Log('passwordElem: '+passwordElem),userNameElem.setAttribute('value','admin'),passwordElem.setAttribute('value','b');var candidate=this.Xyyz.PageData.WinData.Opener.Document.getElementById('LogInBtn');if(this.Xyyz.debug.Log('candidate: '+candidate),candidate)candidate.click();else{candidate=this.Xyyz.PageData.WinData.Opener.Document.querySelector('input.btn');this.Xyyz.debug.Log('candidate: '+candidate),candidate&&candidate.click()}this.Xyyz.debug.FuncEnd(this.AdminB.name)},LocationManager}(SpokeBase)),OneTreeNode=(__extends=this&&this.__extends||function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}(),function(_super){function OneTreeNode(nodeId,nodeFriendly,xyyz){return _super.call(this,xyyz)||this}return __extends(OneTreeNode,_super),OneTreeNode}(SpokeBase)),PageData=(__extends=this&&this.__extends||function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}(),function(_super){function PageData(window,xyyz){var _this=_super.call(this,xyyz)||this;return _this.Start(),_this}return __extends(PageData,_super),PageData.prototype.Start=function(){this.Xyyz.debug.FuncStart(this.constructor.name+' '+this.Start.name),console.log('PageData B'),window.opener?(this.WinData=new WindowData(this.Xyyz),this.WinData.Opener.Window=window.opener,this.WinData.Opener.Document=window.opener.document):this.Xyyz.debug.Error(this.constructor.name,'No Opener Page'),console.log('PageData C'),this.DebugInfo(),this.Xyyz.debug.FuncEnd(this.constructor.name)},PageData.prototype.CurrentOpenerPageState=function(){this.Xyyz.debug.FuncStart(this.CurrentOpenerPageState.name);var toReturn=PageType.Unknown;if(this.WinData&&this.WinData.Opener&&this.WinData.Opener.Window&&this.WinData.Opener.Document){var currentLoc=this.WinData.Opener.Window.location.href;this.Xyyz.debug.Log('currentLoc: '+currentLoc),toReturn=currentLoc.indexOf(this.Xyyz.InjectConst.Url.Login)>-1?PageType.LoginPage:currentLoc.indexOf(this.Xyyz.InjectConst.Url.Desktop)>-1?PageType.Desktop:currentLoc.indexOf(this.Xyyz.InjectConst.Url.ContentEditor)>-1?PageType.ContentEditor:currentLoc.indexOf(this.Xyyz.InjectConst.Url.LaunchPad)>-1?PageType.Launchpad:PageType.Unknown}return this.Xyyz.debug.FuncEnd(this.CurrentOpenerPageState.name+' '+toReturn),toReturn},PageData.prototype.DebugInfo=function(){this.Xyyz.debug.FuncStart(this.DebugInfo.name),this.Xyyz.debug.Log(this.WinData.Opener.Window),this.Xyyz.debug.Log(this.WinData.Opener.Document),this.Xyyz.debug.FuncEnd(this.DebugInfo.name)},PageData}(SpokeBase)),SnapShotOneContentEditorManager=(__extends=this&&this.__extends||function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}(),function(_super){function SnapShotOneContentEditorManager(xyyz){return _super.call(this,xyyz)||this}return __extends(SnapShotOneContentEditorManager,_super),SnapShotOneContentEditorManager.prototype.MakeNewData=function(id){this.Xyyz.debug.FuncStart('MakeNewData: '+id);var toReturn={Id:id,AllTreeNodeAr:[]};return this.Xyyz.debug.FuncEnd('MakeNewData: '+id),toReturn},SnapShotOneContentEditorManager.prototype.DebugDataOneNode=function(dataOneTreeNode){this.Xyyz.debug.FuncStart('DebugDataOneNode');var toReturn=dataOneTreeNode.NodeId+' '+dataOneTreeNode.NodeFriendly;return this.Xyyz.debug.FuncEnd('DebugDataOneNode'),toReturn},SnapShotOneContentEditorManager.prototype.GetDebugDataOneCE=function(dataOneCe){this.Xyyz.debug.FuncStart('GetDebugDataOneCE');var toReturn=[];toReturn.push('------ All Tree Nodes -----');for(var idx=0;idx<dataOneCe.AllTreeNodeAr.length;idx++){this.Xyyz.debug.Log('idx: '+idx);var oneVal=this.DebugDataOneNode(dataOneCe.AllTreeNodeAr[idx]);this.Xyyz.debug.Log('oneVal : '+oneVal),toReturn.push(oneVal)}return this.Xyyz.debug.FuncEnd(this.GetDebugDataOneCE.name),toReturn},SnapShotOneContentEditorManager}(SpokeBase)),Utilities=(__extends=this&&this.__extends||function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}(),function(_super){function Utilities(xyyz){var _this=_super.call(this,xyyz)||this;return xyyz.debug.FuncStart(Utilities.name),xyyz.debug.FuncEnd(Utilities.name),_this}return __extends(Utilities,_super),Utilities.prototype.MakeFriendlyDate=function(date){return date.toDateString()+' '+date.toTimeString()},Utilities.prototype.Uuidv4=function(){return'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g,(function(c){var r=16*Math.random()|0;return('x'==c?r:3&r|8).toString(16)}))},Utilities}(SpokeBase)),Opener=(__extends=this&&this.__extends||function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}(),function(){this.Window=null,this.Document=null}),WindowData=function(_super){function WindowData(xyyz){var _this=_super.call(this,xyyz)||this;return xyyz.debug.FuncStart(_this.constructor.name),_this.Opener=new Opener,xyyz.debug.FuncEnd(_this.constructor.name),xyyz.debug.FuncEnd(_this.constructor.name),_this}return __extends(WindowData,_super),WindowData}(SpokeBase),WindowSnapShotManager=(__extends=this&&this.__extends||function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}(),function(_super){function WindowSnapShotManager(xyyz){var _this=_super.call(this,xyyz)||this;return xyyz.debug.FuncStart(WindowSnapShotManager.name),_this.CreateNewWindowTreeSnapShot(),xyyz.debug.FuncEnd(WindowSnapShotManager.name),_this}return __extends(WindowSnapShotManager,_super),WindowSnapShotManager.prototype.ClearStorage=function(){if(this.Xyyz.debug.FuncStart('ClearStorage'),!0===confirm('Clear Local Storage for Xyyz b?')){var targets=this.__GetAllLocalStorage();if(targets){this.Xyyz.debug.Log('Target Count: '+targets.length);for(var countBefore=targets.length,idx=0;idx<targets.length;idx++){this.Xyyz.debug.Log('idx: '+idx);var oneTarget=targets[idx];this.Xyyz.debug.Log('key: '+oneTarget.key),window.localStorage.removeItem(oneTarget.key)}var countAfter=(targets=this.__GetAllLocalStorage()).length;alert('Count Before: '+countBefore+' Count After: '+countAfter)}else alert('No local storage was found for Xyyz')}this.Xyyz.debug.FuncEnd('ClearStorage')},WindowSnapShotManager.prototype.__GetAllLocalStorage=function(){this.Xyyz.debug.FuncStart('__GetAllLocalStorage ');for(var toReturn=[],idx=0;idx<window.localStorage.length;idx++){var candidate={data:'',key:''};candidate.key=window.localStorage.key(idx),this.Xyyz.debug.Log('candidate.key: '+candidate.key),candidate.key.startsWith(this.Xyyz.InjectConst.Storage.WindowRoot)&&(candidate.data=window.localStorage.getItem(candidate.key),toReturn.push(candidate))}return this.Xyyz.debug.FuncEnd('__GetAllLocalStorage '),toReturn},WindowSnapShotManager.prototype.__drawStorageRaw=function(ourData){this.Xyyz.debug.FuncStart('DrawStorageRaw');for(var idx=0;idx<ourData.length;idx++)this.Xyyz.debug.Log('key: \t'+ourData[idx].key),this.Xyyz.debug.Log('data: \t'+ourData[idx].data),this.Xyyz.debug.Log('------------');this.Xyyz.debug.FuncEnd('DrawStorageRaw')},WindowSnapShotManager.prototype.__drawStoragePretty=function(ourData){this.Xyyz.debug.FuncStart('DrawStoragePretty'),this.Xyyz.FeedbackMan.ClearTextArea();for(var idx=0;idx<ourData.length;idx++){this.Xyyz.debug.Log('key: \t'+ourData[idx].key);var parsed=JSON.parse(ourData[idx].data);parsed&&(this.DrawDebugDataPretty(parsed),this.Xyyz.debug.Log('------------'))}this.Xyyz.debug.FuncEnd('DrawStoragePretty')},WindowSnapShotManager.prototype.DrawStorage=function(){this.Xyyz.debug.FuncStart('DrawStorage');try{var ourData=this.__GetAllLocalStorage();ourData&&(this.__drawStorageRaw(ourData),this.__drawStoragePretty(ourData))}catch(e){xyyz.debug.Error(e.message)}this.Xyyz.debug.FuncEnd('DrawStorage')},WindowSnapShotManager.prototype.PutCEDataToCurrentSnapShot=function(oneCeData){this.Xyyz.debug.FuncStart(this.PutCEDataToCurrentSnapShot.name),this.Xyyz.debug.Log('PutCEDataToCurrentSnapShot');var matchingCeData=this.FindMatchingCeData(oneCeData);matchingCeData?matchingCeData=oneCeData:this.__activeWindowSnapShot.AllCEAr.push(oneCeData),this.UpdateStorage(),this.DrawDebugDataPretty(null),this.Xyyz.debug.FuncEnd(this.PutCEDataToCurrentSnapShot.name)},WindowSnapShotManager.prototype.ShowDebugDataOneWindow=function(){this.Xyyz.debug.FuncStart('ShowDebugDataOneWindow');var toReturn=[];toReturn.push(this.__activeWindowSnapShot.TimeStamp.toJSON());for(var jdx=0;jdx<this.__activeWindowSnapShot.AllCEAr.length;jdx++){var oneCE=this.__activeWindowSnapShot.AllCEAr[jdx];toReturn=toReturn.concat(this.Xyyz.SnapShotOneContentEditorMan.GetDebugDataOneCE(oneCE))}for(var kdx=0;kdx<toReturn.length;kdx++)this.Xyyz.debug.Log(toReturn[kdx]);return this.Xyyz.debug.FuncEnd('ShowDebugDataOneWindow'),toReturn},WindowSnapShotManager.prototype.UpdateStorage=function(){this.Xyyz.debug.FuncStart('UpdateStorage');var snapShotAsString=JSON.stringify(this.__activeWindowSnapShot);this.Xyyz.debug.Log('snapShotAsString: '+snapShotAsString),window.localStorage.setItem(this.Xyyz.InjectConst.Storage.WindowRoot+this.__activeWindowSnapShot.Id,snapShotAsString),this.Xyyz.debug.FuncEnd('UpdateStorage')},WindowSnapShotManager.prototype.FindMatchingCeData=function(oneCeData){for(var toReturn=null,idx=0;idx<this.__activeWindowSnapShot.AllCEAr.length;idx++){var candidate=this.__activeWindowSnapShot.AllCEAr[idx];if(candidate.Id===oneCeData.Id){toReturn=candidate;break}}return this.Xyyz.debug.Log('match found :'+(null!==toReturn)),toReturn},WindowSnapShotManager.prototype.CreateNewWindowTreeSnapShot=function(){this.Xyyz.debug.FuncStart('CreateNewWindowTreeSnapShot');var dateToUse=new Date;this.__activeWindowSnapShot={TimeStamp:dateToUse,AllCEAr:[],Id:this.Xyyz.Utilities.Uuidv4()},this.Xyyz.debug.FuncEnd('CreateNewWindowTreeSnapShot')},WindowSnapShotManager.prototype.DrawDebugDataPretty=function(source){for(var allDebugData=this.__buildDebugDataPretty(source),ldx=0;ldx<allDebugData.length;ldx++)this.Xyyz.FeedbackMan.WriteLine(allDebugData[ldx])},WindowSnapShotManager.prototype.__buildDebugDataPretty=function(source){this.Xyyz.debug.FuncStart(this.__buildDebugDataPretty.name),source||(source=this.__activeWindowSnapShot);var toReturn=[];toReturn.push('------ One Window Snap Shot Start -----'),toReturn.push('Id: '+source.Id),toReturn.push('TimeStamp: '+source.TimeStamp),toReturn.push('CE Count: '+source.AllCEAr.length);for(var jdx=0;jdx<source.AllCEAr.length;jdx++){toReturn.push('\t------ One CE -----');var dataOneCE=source.AllCEAr[jdx];toReturn.push('\tId: '+dataOneCE.Id);for(var allCeDebugDataAr=this.Xyyz.SnapShotOneContentEditorMan.GetDebugDataOneCE(dataOneCE),kdx=0;kdx<allCeDebugDataAr.length;kdx++)toReturn.push('\t\t'+allCeDebugDataAr[kdx])}return toReturn.push('------ One Window Snap Shot End -----'),this.Xyyz.debug.FuncEnd(this.__buildDebugDataPretty.name),toReturn},WindowSnapShotManager}(SpokeBase));!function(PageType){PageType[PageType.Unknown=0]='Unknown',PageType[PageType.LoginPage=1]='LoginPage',PageType[PageType.Desktop=2]='Desktop',PageType[PageType.ContentEditor=3]='ContentEditor',PageType[PageType.Launchpad=4]='Launchpad'}(PageType||(PageType={}));__extends=this&&this.__extends||function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();console.log('EventManager loaded');var EventManager=function(_super){function EventManager(xyyz){return _super.call(this,xyyz)||this}return __extends(EventManager,_super),EventManager.prototype.WireMenuButtons=function(){this.Xyyz.debug.FuncStart(EventManager.name+' '+this.WireMenuButtons.name);var thisObj=this;document.getElementById('btnEdit').onclick=function(){thisObj.Xyyz.LocationMan.SetScMode('edit')},document.getElementById('btnPrev').onclick=function(){thisObj.Xyyz.LocationMan.SetScMode('preview')},document.getElementById('btnNorm').onclick=function(){thisObj.Xyyz.LocationMan.SetScMode('normal')},document.getElementById('btnAdminB').onclick=function(){thisObj.Xyyz.LocationMan.AdminB()},document.getElementById('btnDesktop').onclick=function(){thisObj.Xyyz.LocationMan.ChangeLocation(PageType.Desktop)},document.getElementById('btnCE').onclick=function(){thisObj.Xyyz.LocationMan.ChangeLocation(PageType.ContentEditor)},document.getElementById('btnSaveTheTrees').onclick=function(){thisObj.Xyyz.ManyTreesMan.SaveAllTrees()},document.getElementById('btnPlantTheTrees').onclick=function(){thisObj.Xyyz.ManyTreesMan.PlantTheTrees(window.opener.document,0)},document.getElementById('btnDrawLocalStorage').onclick=function(){thisObj.Xyyz.WindowTreeSnapShotMan.DrawStorage()},document.getElementById('btnClearLocalStorage').onclick=function(){thisObj.Xyyz.WindowTreeSnapShotMan.ClearStorage()},document.getElementById('btnClearTextArea').onclick=function(){thisObj.Xyyz.debug.ClearTextArea()},this.Xyyz.debug.FuncEnd(this.WireMenuButtons.name)},EventManager}(SpokeBase);__extends=this&&this.__extends||function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();console.log('InjectConst loaded');var InjectConst=function(_super){function InjectConst(xyyz){var _this=_super.call(this,xyyz)||this;return _this.ElemId={textAreaFeedback:'ta-feedback'},_this.ClassNames={ContentTreeNode:'scContentTreeNode'},_this.Url={Desktop:'/sitecore/shell/default.aspx',Login:'/sitecore/login',ContentEditor:'/sitecore/shell/Applications/Content%20Editor.aspx',LaunchPad:'/sitecore/shell/sitecore/client/applications/launchpad'},_this.Selector={ContentTreeNodeGlyph:'.scContentTreeNodeGlyph',RootNodeId:'Tree_Node_11111111111111111111111111111111'},_this.Storage={WindowRoot:'Xyyz.WindowSnapShot.'},_this.TreeExpandedPng='treemenu_expanded.png',_this.MaxIter=100,_this.GuidEmpty='00000000-0000-0000-0000-000000000000',_this.prop={AllTreeData:'AllTreeData'},_this.Names={HtmlToInject:'HtmlToInject',StylesToInject:'StylesToInject'},xyyz.debug.FuncStart(InjectConst.name),xyyz.debug.FuncEnd(InjectConst.name),_this}return __extends(InjectConst,_super),InjectConst}(SpokeBase);(xyyz=xyyz||{}).OneCEIframe=function(){this.Index=-1,this.TreeData={}},xyyz.TreeData=function(){this.DateStamp=Date.now(),this.AllCEIframes=[]},console.log('StorageMan loaded'),xyyz.StorageMan={GetTreeData:function(treeIdx){xyyz.debug.Log('s) GetTreeData');var foundInStorageJson=window.localStorage.getItem(xyyz.InjectConst.Storage.WindowRoot);if(foundInStorageJson){var allTreeDataAr=JSON.parse(foundInStorageJson)[xyyz.InjectConst.prop.AllTreeData];allTreeDataAr.length<=treeIdx&&allTreeDataAr[treeIdx]}return xyyz.debug.Log('e) GetTreeData'),treeIdx}};__extends=this&&this.__extends||function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();console.log('ManyTrees loaded');var ManyTrees=function(_super){function ManyTrees(xyyz){var _this;return xyyz.debug.FuncStart(ManyTrees.name),_this=_super.call(this,xyyz)||this,xyyz.debug.FuncEnd(ManyTrees.name),_this}return __extends(ManyTrees,_super),ManyTrees.prototype.GetAllLiveIframeData=function(targetDoc){this.Xyyz.debug.FuncStart(this.GetAllLiveIframeData.name);var toReturn=[],iframeAr=targetDoc.querySelectorAll('iframe[src*=content]');if(iframeAr){this.Xyyz.debug.Log('iframeAr: '+iframeAr.length);for(var ifrIdx=0;ifrIdx<iframeAr.length;ifrIdx++)this.Xyyz.debug.Log('pushing: '+ifrIdx),toReturn.push(new ClassOneLivingIframe(ifrIdx,iframeAr[ifrIdx],this.Xyyz))}return this.Xyyz.debug.FuncEnd(this.GetAllLiveIframeData.name+' '+toReturn.length),toReturn},ManyTrees.prototype.PlantTheTrees=function(targetDoc,treeIdx){this.Xyyz.debug.Log('s) LookAtExistingData: '+treeIdx)},ManyTrees.prototype.SaveOneContentEditor=function(id,docElem){this.Xyyz.debug.FuncStart('SaveOneContentEditor'),this.Xyyz.debug.Log('SaveOneContentEditor'),this.Xyyz.debug.Log('docElem is null: '+(null===docElem)),id||(id=this.Xyyz.InjectConst.GuidEmpty),docElem||(docElem=this.Xyyz.PageData.WinData.Opener.Document,this.Xyyz.debug.Log('Assigning docElem: '+docElem)),this.Xyyz.debug.Log('docElem is null: '+(null===docElem));var CeSnapShot=this.Xyyz.SnapShotOneContentEditorMan.MakeNewData(id);CeSnapShot.AllTreeNodeAr=this.Xyyz.OneTreeMan.GetOneLiveTreeData(CeSnapShot,docElem),this.Xyyz.WindowTreeSnapShotMan.DrawDebugDataPretty(null),this.Xyyz.WindowTreeSnapShotMan.PutCEDataToCurrentSnapShot(CeSnapShot),this.Xyyz.debug.FuncEnd('SaveOneContentEditor')},ManyTrees.prototype.SaveOneDesktop=function(){this.Xyyz.debug.FuncStart(this.SaveOneDesktop.name),this.Xyyz.debug.FuncStart('SaveOneDesktop');var livingIframeAr=this.GetAllLiveIframeData(this.Xyyz.PageData.WinData.Opener.Document);if(livingIframeAr&&livingIframeAr.length>0)for(var iframeIdx=0;iframeIdx<livingIframeAr.length;iframeIdx++){this.Xyyz.debug.Log('iframeIdx: '+iframeIdx);var targetIframeObj=livingIframeAr[iframeIdx];this.Xyyz.debug.Log('targetIframe: '+JSON.stringify(targetIframeObj)),this.SaveOneContentEditor(iframeIdx,targetIframeObj.DocElem)}this.Xyyz.debug.Log('done gathering tree data'),this.Xyyz.WindowTreeSnapShotMan.DrawDebugDataPretty(null),this.Xyyz.debug.FuncEnd(this.SaveOneDesktop.name)},ManyTrees.prototype.SaveAllTrees=function(){this.Xyyz.debug.FuncStart(this.SaveAllTrees.name),this.Xyyz.WindowTreeSnapShotMan.CreateNewWindowTreeSnapShot();var currentState=this.Xyyz.PageData.CurrentOpenerPageState();currentState===PageType.ContentEditor?(this.Xyyz.debug.Log('is Content Editor'),this.SaveOneContentEditor(null,null)):currentState===PageType.Desktop?(this.Xyyz.debug.Log('is Desktop'),this.SaveOneDesktop()):this.Xyyz.debug.Error(this.SaveAllTrees.name,'Invalid page location '+currentState),this.Xyyz.debug.FuncEnd(this.SaveAllTrees.name)},ManyTrees}(SpokeBase);__extends=this&&this.__extends||function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();console.log('OneTree loaded');var OneTreeManager=function(_super){function OneTreeManager(xyyz){var _this=_super.call(this,xyyz)||this;return xyyz.debug.FuncStart(OneTreeManager.name),xyyz.debug.FuncEnd(OneTreeManager.name),_this}return __extends(OneTreeManager,_super),OneTreeManager.prototype.GetFriendlyNameFromNode=function(inputNode){this.Xyyz.debug.FuncStart(this.GetFriendlyNameFromNode.name);var toReturn='unknown',treeNode=inputNode.parentNode.querySelector('[id^=Tree_Node_]');return treeNode?toReturn=treeNode.innerText:this.Xyyz.debug.Log('No treeNode'),this.Xyyz.debug.FuncEnd(this.GetFriendlyNameFromNode.toString+' '+toReturn),toReturn},OneTreeManager.prototype.WalkNodeRecursive=function(targetNode,depth){var toReturn=[];if(depth-=1,targetNode){if(targetNode.className===this.Xyyz.InjectConst.ClassNames.ContentTreeNode){var firstImg=targetNode.querySelector(this.Xyyz.InjectConst.Selector.ContentTreeNodeGlyph);if(firstImg)if(firstImg.getAttribute('src').indexOf(this.Xyyz.InjectConst.TreeExpandedPng)>-1){var newData={NodeFriendly:this.GetFriendlyNameFromNode(firstImg),NodeId:firstImg.id};toReturn.push(newData)}}var childNodes=targetNode.children;if(childNodes&&childNodes.length>0&&depth>0)for(var jdx=0;jdx<childNodes.length;jdx++){var oneChild=childNodes[jdx];toReturn=toReturn.concat(this.WalkNodeRecursive(oneChild,depth))}}return toReturn},OneTreeManager.prototype.GetOneLiveTreeData=function(dataOneCe,targetDoc){this.Xyyz.debug.FuncStart(this.GetOneLiveTreeData.name+'b idx: '+dataOneCe.Id),this.Xyyz.debug.Log('targetDoc isnull xx: '+(null===targetDoc));var toReturn=[];if(targetDoc){this.Xyyz.debug.Log(targetDoc);var rootNode=targetDoc.getElementById(this.Xyyz.InjectConst.Selector.RootNodeId);if(rootNode){this.Xyyz.debug.Log('rootNode: '+rootNode.innerHTML);var rootParent=rootNode.parentElement;toReturn=this.WalkNodeRecursive(rootParent,this.Xyyz.InjectConst.MaxIter),this.Xyyz.debug.Log('foundNodes count: '+toReturn.length)}else this.Xyyz.debug.Error(this.GetOneLiveTreeData.name,'no root node')}else this.Xyyz.debug.Error(this.GetOneLiveTreeData.name,'no targetDoc');return this.Xyyz.debug.FuncEnd(this.GetOneLiveTreeData.name),toReturn},OneTreeManager}(SpokeBase);console.log('marker aa');var xyyz=xyyz||{};this.xyyz.HubObj=new Hub,console.log('marker bb');